@use '../../styles/variables' as *;

/* ══════════════════════════════════════
   THE ARENA — Dark Colosseum
   ══════════════════════════════════════ */

// Palette
$crimson: #c41e3a;
$crimson-glow: rgba(196, 30, 58, 0.6);
$blood: #8b0000;
$gold: #c0a062;
$gold-dim: rgba(192, 160, 98, 0.25);
$gold-border: rgba(192, 160, 98, 0.18);
$ivory: #e8dcc8;
$ivory-mid: rgba(232, 220, 200, 0.65);
$ivory-faint: rgba(232, 220, 200, 0.30);

/* ── Page ── */
.arena {
  position: relative;
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background:
    radial-gradient(ellipse at 50% 100%, rgba($blood, 0.12) 0%, transparent 55%),
    radial-gradient(ellipse at 20% 0%, #0f1a2e 0%, transparent 50%),
    radial-gradient(ellipse at 80% 10%, #1a0f2e 0%, transparent 50%),
    linear-gradient(to bottom, #05080f 0%, #0a0f1a 40%, #12100d 100%);

  @media (max-width: $bp-medium) {
    height: calc(100vh - #{$topbar-height});
  }
}

/* ══════════════════════════════════════
   ATMOSPHERIC LAYERS
   ══════════════════════════════════════ */

.arena__stars {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background-image:
    radial-gradient(1px 1px at 10% 15%, rgba(255, 200, 200, 0.5), transparent),
    radial-gradient(1px 1px at 25% 35%, rgba(255, 255, 255, 0.4), transparent),
    radial-gradient(1.5px 1.5px at 40% 8%, rgba(255, 220, 220, 0.6), transparent),
    radial-gradient(1px 1px at 55% 42%, rgba(255, 255, 255, 0.35), transparent),
    radial-gradient(1px 1px at 65% 18%, rgba(255, 200, 200, 0.5), transparent),
    radial-gradient(1.5px 1.5px at 78% 52%, rgba(255, 255, 255, 0.4), transparent),
    radial-gradient(1px 1px at 88% 28%, rgba(255, 220, 220, 0.55), transparent),
    radial-gradient(1px 1px at 15% 62%, rgba(255, 255, 255, 0.3), transparent),
    radial-gradient(1.5px 1.5px at 35% 78%, rgba(255, 200, 200, 0.45), transparent),
    radial-gradient(1px 1px at 72% 72%, rgba(255, 255, 255, 0.35), transparent),
    radial-gradient(1px 1px at 92% 85%, rgba(255, 220, 220, 0.4), transparent),
    radial-gradient(1px 1px at 82% 5%, rgba(255, 200, 200, 0.5), transparent);
  animation: arena-twinkle 4s ease-in-out infinite alternate;

  &--mid {
    opacity: 0.5;
    background-image:
      radial-gradient(1px 1px at 12% 28%, rgba(200, 180, 180, 0.5), transparent),
      radial-gradient(1.5px 1.5px at 30% 12%, rgba(200, 180, 180, 0.4), transparent),
      radial-gradient(1px 1px at 58% 65%, rgba(255, 200, 160, 0.5), transparent),
      radial-gradient(1px 1px at 75% 38%, rgba(200, 180, 180, 0.6), transparent),
      radial-gradient(1px 1px at 42% 92%, rgba(255, 200, 160, 0.4), transparent),
      radial-gradient(1px 1px at 20% 75%, rgba(200, 180, 180, 0.5), transparent);
    animation: arena-twinkle 6s ease-in-out 1s infinite alternate;
  }
}

.arena__embers {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

.arena__ember {
  position: absolute;
  border-radius: 50%;
  opacity: 0;
  animation: arena-rise linear infinite;

  @for $i from 1 through 8 {
    &:nth-child(#{$i}) {
      $size: 2px + random(3) * 1px;
      width: $size;
      height: $size;
      left: 30% + random(40) * 1%;
      bottom: random(8) * 1%;
      background: nth(
        (#ff8c32 #ffad42 #ff6a1a #ffc857 #ff5e2b #ffad42 #ff8c32 #ffc857),
        $i
      );
      box-shadow: 0 0 #{3 + random(4)}px currentColor;
      animation-duration: #{4 + random(5)}s;
      animation-delay: #{random(50) / 10}s;
    }
  }
}

.arena__mist {
  position: absolute;
  bottom: 0;
  left: -50%;
  width: 200%;
  height: 30%;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(ellipse at 25% 80%, rgba($blood, 0.05) 0%, transparent 50%),
    radial-gradient(ellipse at 60% 60%, rgba(140, 160, 190, 0.04) 0%, transparent 45%),
    radial-gradient(ellipse at 80% 90%, rgba($blood, 0.04) 0%, transparent 40%);
  animation: arena-drift 20s ease-in-out infinite;

  &--reverse {
    bottom: 5%;
    opacity: 0.5;
    animation: arena-drift 25s ease-in-out 5s infinite reverse;
  }
}

/* ══════════════════════════════════════
   TOP BAR
   ══════════════════════════════════════ */
.arena__bar {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  height: $topbar-height;
  padding: 0 0.75rem;
  background: rgba(5, 8, 15, 0.85);
  border-bottom: 1px solid $gold-border;
  backdrop-filter: blur(8px);
  flex-shrink: 0;
  z-index: 10;
  position: relative;
}

.arena__bar-back {
  display: flex;
  align-items: center;
  gap: 0.15rem;
  font-family: 'Inter', sans-serif;
  font-size: 0.7rem;
  font-weight: 500;
  color: $ivory-mid;
  text-decoration: none;
  padding: 0.25rem 0.5rem 0.25rem 0.2rem;
  border-radius: 6px;
  transition: color 0.15s, background 0.15s;
  white-space: nowrap;
  flex-shrink: 0;

  svg { width: 15px; height: 15px; }

  &:hover {
    color: $gold;
    background: rgba($gold, 0.08);
  }
}

.arena__bar-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  min-width: 0;
}

.arena__bar-name {
  font-family: 'Cinzel', serif;
  font-size: 0.9rem;
  font-weight: 900;
  color: $gold;
  letter-spacing: 0.04em;
  text-shadow: 0 0 16px rgba($gold, 0.25);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  @media (max-width: $bp-compact) {
    max-width: 140px;
    font-size: 0.8rem;
  }
}

.arena__bar-code {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  font-weight: 500;
  color: $ivory-faint;
  letter-spacing: 0.1em;
  flex-shrink: 0;
}

.arena__bar-status {
  font-family: 'Inter', sans-serif;
  font-size: 0.52rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 0.12rem 0.45rem;
  border-radius: 20px;
  flex-shrink: 0;

  &--waiting {
    color: $gold;
    background: rgba($gold, 0.12);
    border: 1px solid rgba($gold, 0.2);
    animation: arena-shimmer 2.5s ease-in-out infinite;
  }

  &--ready {
    color: #2ecc71;
    background: rgba(#2ecc71, 0.12);
    border: 1px solid rgba(#2ecc71, 0.2);
  }

  &--battling {
    color: $crimson;
    background: rgba($crimson, 0.15);
    border: 1px solid rgba($crimson, 0.3);
    animation: arena-pulse 1.5s ease-in-out infinite;
  }

  &--finished {
    color: $ivory-mid;
    background: rgba($ivory, 0.06);
    border: 1px solid rgba($ivory, 0.1);
  }
}

.arena__bar-spacer { flex: 1; }

.arena__bar-meta {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  flex-shrink: 0;

  @media (max-width: $bp-mobile) { display: none; }
}

.arena__bar-badge {
  font-family: 'Inter', sans-serif;
  font-size: 0.52rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  padding: 0.12rem 0.4rem;
  border-radius: 12px;
  color: $ivory-mid;
  background: rgba($ivory, 0.06);
  border: 1px solid rgba($ivory, 0.1);

  &--spectator {
    color: rgba(#9b59b6, 0.9);
    background: rgba(#9b59b6, 0.12);
    border-color: rgba(#9b59b6, 0.2);
  }
}

.arena__bar-viewers {
  font-family: 'Inter', sans-serif;
  font-size: 0.6rem;
  color: $ivory-faint;
}

.arena__bar-share {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-shrink: 0;
}

.arena__share-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  border: 1px solid $gold-border;
  background: rgba($gold, 0.05);
  color: $ivory-mid;
  cursor: pointer;
  transition: all 0.15s;
  padding: 0;

  svg { width: 14px; height: 14px; }

  &:hover {
    color: $gold;
    background: rgba($gold, 0.12);
    border-color: rgba($gold, 0.3);
  }

  &--copied {
    color: #2ecc71;
    border-color: rgba(#2ecc71, 0.3);
    background: rgba(#2ecc71, 0.1);
  }
}

.arena__bar-hint {
  font-family: 'Philosopher', sans-serif;
  font-size: 0.65rem;
  color: $ivory-faint;
  font-style: italic;
  animation: arena-shimmer 2.5s ease-in-out infinite;
  white-space: nowrap;

  @media (max-width: $bp-compact) { display: none; }
}

/* ══════════════════════════════════════
   BATTLE FIELD
   ══════════════════════════════════════ */
.arena__field {
  flex: 1;
  display: flex;
  min-height: 0;
  position: relative;
  z-index: 1;
}

.arena__half {
  flex: 1;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 1.25rem 0.75rem;
  overflow-y: auto;
  position: relative;
  background: linear-gradient(180deg, rgba(8, 6, 4, 0.92) 0%, rgba(12, 8, 6, 0.88) 100%);

  &::-webkit-scrollbar { width: 4px; }
  &::-webkit-scrollbar-track { background: transparent; }
  &::-webkit-scrollbar-thumb {
    background: rgba($gold, 0.15);
    border-radius: 2px;
  }

  &--left {
    box-shadow: inset 12px 0 40px color-mix(in srgb, var(--ci-primary, $crimson) 10%, transparent);
  }

  &--right {
    box-shadow: inset -12px 0 40px color-mix(in srgb, var(--ci-primary, $crimson) 10%, transparent);
  }

  &--empty {
    background: linear-gradient(180deg, rgba(6, 4, 3, 0.95) 0%, rgba(10, 6, 4, 0.90) 100%);
    box-shadow: none;
  }
}

/* ── VS Divider ── */
.arena__divider {
  width: 2px;
  background: linear-gradient(
    to bottom,
    transparent 0%,
    $crimson 15%,
    rgba($crimson, 0.9) 50%,
    $crimson 85%,
    transparent 100%
  );
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  flex-shrink: 0;
  box-shadow:
    0 0 12px $crimson-glow,
    0 0 30px rgba($crimson, 0.2);
  animation: arena-divider-breathe 3s ease-in-out infinite;
}

.arena__vs-ring {
  position: absolute;
  width: 52px;
  height: 52px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, #1a0505 0%, #0a0505 70%);
  border: 2px solid $crimson;
  box-shadow:
    0 0 0 4px rgba(5, 8, 15, 0.9),
    0 0 20px $crimson-glow,
    0 0 40px rgba($crimson, 0.25),
    inset 0 0 12px rgba($blood, 0.4);
  z-index: 2;
  animation: arena-vs-pulse 2.5s ease-in-out infinite;
}

.arena__vs {
  font-family: 'Cinzel', serif;
  font-size: 0.85rem;
  font-weight: 900;
  color: $crimson;
  letter-spacing: 0.05em;
  text-shadow:
    0 0 8px $crimson-glow,
    0 0 18px rgba($crimson, 0.3);
}

.arena__empty-slot {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;

  span {
    font-family: 'Philosopher', sans-serif;
    color: $ivory-faint;
    font-size: 0.95rem;
    font-style: italic;
    animation: arena-pulse 2.5s ease-in-out infinite;
  }
}

/* ══════════════════════════════════════
   FOOTER ACTIONS
   ══════════════════════════════════════ */
.arena__actions {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  gap: 0.75rem;
  padding: 0.75rem;
  background: linear-gradient(to top, rgba(5, 8, 15, 0.9), transparent);
  z-index: 5;
  pointer-events: none;
}

.arena__action-btn {
  pointer-events: all;
  font-family: 'Inter', sans-serif;
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 0.4rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
  text-decoration: none;

  &--secondary {
    background: rgba($ivory, 0.06);
    color: $ivory-mid;
    border: 1px solid rgba($ivory, 0.12);

    &:hover { background: rgba($ivory, 0.1); color: $ivory; }
  }

  &--danger {
    background: rgba($crimson, 0.12);
    color: rgba($crimson, 0.9);
    border: 1px solid rgba($crimson, 0.2);

    &:hover { background: rgba($crimson, 0.2); color: $crimson; }
  }
}

/* ══════════════════════════════════════
   ERROR / LOADING
   ══════════════════════════════════════ */
.arena__state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  z-index: 1;
}

.arena__state-msg {
  font-family: 'Philosopher', sans-serif;
  color: $crimson;
  font-size: 0.95rem;
}

.arena__state-loader {
  .app-loader__ring {
    border-color: $gold-border;
    border-top-color: $gold;
  }
}

/* ══════════════════════════════════════
   KEYFRAMES
   ══════════════════════════════════════ */
@keyframes arena-twinkle {
  0%   { opacity: 0.4; }
  100% { opacity: 1; }
}

@keyframes arena-rise {
  0% { opacity: 0; transform: translateY(0) translateX(0) scale(1); }
  10% { opacity: 0.8; }
  50% { opacity: 0.5; }
  100% { opacity: 0; transform: translateY(-65vh) translateX(#{-15 + random(30)}px) scale(0.2); }
}

@keyframes arena-drift {
  0%, 100% { transform: translateX(0); }
  50%      { transform: translateX(8%); }
}

@keyframes arena-divider-breathe {
  0%, 100% { box-shadow: 0 0 12px $crimson-glow, 0 0 30px rgba($crimson, 0.2); }
  50%      { box-shadow: 0 0 20px rgba($crimson, 0.8), 0 0 50px rgba($crimson, 0.3); }
}

@keyframes arena-vs-pulse {
  0%, 100% {
    box-shadow: 0 0 0 4px rgba(5,8,15,0.9), 0 0 20px $crimson-glow, 0 0 40px rgba($crimson,0.25), inset 0 0 12px rgba($blood,0.4);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 0 4px rgba(5,8,15,0.9), 0 0 28px rgba($crimson,0.85), 0 0 55px rgba($crimson,0.35), inset 0 0 18px rgba($blood,0.55);
    transform: scale(1.05);
  }
}

@keyframes arena-pulse {
  0%, 100% { opacity: 1; }
  50%      { opacity: 0.45; }
}

@keyframes arena-shimmer {
  0%, 100% { opacity: 0.65; }
  50%      { opacity: 1; }
}

/* ══════════════════════════════════════
   RESPONSIVE
   ══════════════════════════════════════ */
@media (max-width: $bp-medium) {
  .arena__field {
    flex-direction: column;
    overflow-y: auto;
  }

  .arena__half {
    overflow-y: visible;
    padding: 1.25rem 0.75rem;
    &--left, &--right { box-shadow: none; }
  }

  .arena__divider {
    width: 100%;
    height: 2px;
    flex-shrink: 0;
    background: linear-gradient(to right, transparent 0%, $crimson 15%, rgba($crimson, 0.9) 50%, $crimson 85%, transparent 100%);
  }

  .arena__vs-ring {
    position: static;
    margin: -26px auto;
  }

  .arena__embers, .arena__mist { display: none; }

  .arena__actions {
    position: static;
    background: rgba(5, 8, 15, 0.6);
  }
}
