{"version":3,"file":"static/js/485.a8418e11.chunk.js","mappings":"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","sources":["components/DiceRoller/D6/CubeDie.tsx","components/DiceRoller/D6/D6Scene.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react';\nimport { useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  primary: string;\n  primaryDark: string;\n  fixedResult?: number;\n}\n\n/** Cube half-size */\nconst S = 0.85;\n\n/** 8 vertices of the cube */\nconst VERTS: THREE.Vector3Tuple[] = [\n  [-S, -S, -S], [-S, -S, S], [-S, S, -S], [-S, S, S],\n  [S, -S, -S], [S, -S, S], [S, S, -S], [S, S, S],\n];\n\n/** 12 edges (vertex index pairs) */\nconst EDGE_INDICES: [number, number][] = [\n  [0, 1], [1, 5], [5, 4], [4, 0], // bottom face\n  [2, 3], [3, 7], [7, 6], [6, 2], // top face\n  [0, 2], [1, 3], [4, 6], [5, 7], // verticals\n];\n\n/** Face normals for BoxGeometry groups: +X, -X, +Y, -Y, +Z, -Z */\nconst FACE_NORMALS: THREE.Vector3[] = [\n  new THREE.Vector3(1, 0, 0),\n  new THREE.Vector3(-1, 0, 0),\n  new THREE.Vector3(0, 1, 0),\n  new THREE.Vector3(0, -1, 0),\n  new THREE.Vector3(0, 0, 1),\n  new THREE.Vector3(0, 0, -1),\n];\n\n/** Pip value per BoxGeometry group: +X=2, -X=5, +Y=3, -Y=4, +Z=1, -Z=6 */\nconst FACE_VALUES = [2, 5, 3, 4, 1, 6];\n\n\n/** Target quaternions: rotate so face N points toward +Z (camera) */\nconst TARGET_QUATS: Record<number, THREE.Quaternion> = {\n  1: new THREE.Quaternion(),\n  2: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), -Math.PI / 2),\n  3: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), Math.PI / 2),\n  4: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1, 0, 0), -Math.PI / 2),\n  5: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI / 2),\n  6: new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI),\n};\n\nconst EDGE_RADIUS = 0.02;\nconst SPIN_DURATION = 1.5;\nconst SETTLE_DURATION = 0.3;\nconst FLASH_DURATION = SETTLE_DURATION;\nconst camDir = new THREE.Vector3(0, 0, 1);\n\n/* ── Color helpers ── */\n\nfunction parseColor(color: string): [number, number, number] {\n  const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n  if (rgbMatch) return [+rgbMatch[1], +rgbMatch[2], +rgbMatch[3]];\n  const h = color.replace('#', '');\n  const n = parseInt(h.length === 3 ? h.split('').map(c => c + c).join('') : h, 16);\n  return [(n >> 16) & 255, (n >> 8) & 255, n & 255];\n}\n\nfunction luminance(color: string): number {\n  const [r, g, b] = parseColor(color).map(c => {\n    const s = c / 255;\n    return s <= 0.03928 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4);\n  });\n  return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n}\n\nfunction contrastText(bg: string): string {\n  const lum = luminance(bg);\n  if (lum > 0.85) return bg;\n  return lum > 0.4 ? '#000000' : '#ffffff';\n}\n\nfunction darken(color: string, ratio: number): string {\n  const [r, g, b] = parseColor(color);\n  const m = (c: number) => Math.round(c * (1 - ratio));\n  return `rgb(${m(r)},${m(g)},${m(b)})`;\n}\n\n/* ── Texture / geometry builders ── */\n\nfunction makeFaceTexture(num: number, primary: string): THREE.CanvasTexture {\n  const size = 512;\n  const canvas = document.createElement('canvas');\n  canvas.width = size;\n  canvas.height = size;\n  const ctx = canvas.getContext('2d')!;\n\n  ctx.fillStyle = primary;\n  ctx.fillRect(0, 0, size, size);\n\n  const textColor = contrastText(primary);\n  ctx.fillStyle = textColor;\n  ctx.font = 'bold 180px sans-serif';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(String(num), size / 2, size / 2);\n\n  const tex = new THREE.CanvasTexture(canvas);\n  tex.needsUpdate = true;\n  return tex;\n}\n\nfunction makeEdgeCylinder(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple, radius: number, baseColor: THREE.Color): THREE.CylinderGeometry {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const height = va.distanceTo(vb);\n  const geo = new THREE.CylinderGeometry(radius, radius, height, 8, 1);\n\n  const tA = (a[1] + S) / (2 * S);\n  const tB = (b[1] + S) / (2 * S);\n  const positions = geo.attributes.position;\n  const colors = new Float32Array(positions.count * 3);\n\n  for (let i = 0; i < positions.count; i++) {\n    const y = positions.getY(i);\n    const along = (y + height / 2) / height;\n    const tint = 0.5 + 0.45 * (tA + (tB - tA) * along);\n    colors[i * 3] = baseColor.r * tint;\n    colors[i * 3 + 1] = baseColor.g * tint;\n    colors[i * 3 + 2] = baseColor.b * tint;\n  }\n\n  geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n  return geo;\n}\n\nfunction edgeTransform(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple): { pos: THREE.Vector3; quat: THREE.Quaternion } {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const mid = va.clone().add(vb).multiplyScalar(0.5);\n  const dir = vb.clone().sub(va).normalize();\n  const quat = new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 1, 0), dir);\n  return { pos: mid, quat };\n}\n\n/* ── Component ── */\n\nexport default function CubeDie({ rollTrigger, onResult, primary, primaryDark, fixedResult }: Props) {\n  const groupRef = useRef<THREE.Group>(null);\n  const prevTrigger = useRef(0);\n  const hasReported = useRef(false);\n\n  const spinning = useRef(false);\n  const spinStart = useRef(0);\n  const spinAxis = useRef(new THREE.Vector3(1, 1, 0).normalize());\n  const spinSpeed = useRef(8);\n  const targetResult = useRef(0);\n  const targetQuat = useRef(new THREE.Quaternion());\n  const settleStartQuat = useRef(new THREE.Quaternion());\n  const settleStart = useRef(0);\n\n  const flashing = useRef(false);\n  const flashStart = useRef(0);\n\n  const edgeBaseColor = useMemo(() => new THREE.Color(darken(primary, -0.35)), [primary]);\n  const worldNormal = useRef(new THREE.Vector3());\n\n  const geometry = useMemo(() => new THREE.BoxGeometry(S * 2, S * 2, S * 2), []);\n\n  const materials = useMemo(() =>\n    FACE_VALUES.map(v => new THREE.MeshBasicMaterial({ map: makeFaceTexture(v, primary) })),\n    [primary],\n  );\n\n  const edges = useMemo(() =>\n    EDGE_INDICES.map(([ai, bi]) => ({\n      geo: makeEdgeCylinder(VERTS[ai], VERTS[bi], EDGE_RADIUS, edgeBaseColor),\n      ...edgeTransform(VERTS[ai], VERTS[bi]),\n    })),\n    [edgeBaseColor],\n  );\n\n  const sphereGeo = useMemo(() => new THREE.SphereGeometry(EDGE_RADIUS, 8, 8), []);\n\n  // Roll trigger\n  useEffect(() => {\n    if (rollTrigger === 0) return;\n    if (rollTrigger === prevTrigger.current) return;\n    prevTrigger.current = rollTrigger;\n\n    hasReported.current = false;\n    spinning.current = true;\n    spinStart.current = 0;\n\n    const sx = Math.random() < 0.5 ? -1 : 1;\n    const sy = Math.random() < 0.5 ? -1 : 1;\n    const sz = Math.random() < 0.5 ? -1 : 1;\n\n    spinAxis.current\n      .set(\n        sx * (0.5 + Math.random() * 0.5),\n        sy * (0.5 + Math.random() * 0.5),\n        sz * (0.5 + Math.random() * 0.5),\n      )\n      .normalize();\n\n    spinSpeed.current = 14 + Math.random() * 4;\n\n    targetResult.current = fixedResult ?? (Math.floor(Math.random() * 6) + 1);\n    targetQuat.current.copy(TARGET_QUATS[targetResult.current]);\n  }, [rollTrigger]);\n\n  // Tint faces based on camera-facing direction + flash\n  const tintFaces = () => {\n    if (!groupRef.current) return;\n\n    let flash = 0;\n    if (flashing.current && flashStart.current > 0) {\n      const flashElapsed = performance.now() / 1000 - flashStart.current;\n      const ft = Math.min(flashElapsed / FLASH_DURATION, 1);\n      flash = 1 - ft;\n      if (ft >= 1) flashing.current = false;\n\n      const scalePunch = 1 + 0.08 * Math.sin(ft * Math.PI);\n      groupRef.current.scale.setScalar(scalePunch);\n    }\n\n    for (let i = 0; i < 6; i++) {\n      worldNormal.current.copy(FACE_NORMALS[i]).applyQuaternion(groupRef.current.quaternion);\n      const dot = worldNormal.current.dot(camDir);\n      let brightness = 0.55 + 0.45 * Math.max(0, dot);\n      if (flash > 0) {\n        brightness = brightness + (2.0 - brightness) * flash * 0.6;\n      }\n      materials[i].color.setScalar(brightness);\n    }\n  };\n\n  useFrame((_, delta) => {\n    if (!groupRef.current) return;\n\n    tintFaces();\n\n    if (!spinning.current) return;\n\n    if (spinStart.current === 0) {\n      spinStart.current = performance.now() / 1000;\n      settleStart.current = 0;\n    }\n\n    const elapsed = performance.now() / 1000 - spinStart.current;\n\n    if (elapsed < SPIN_DURATION) {\n      const progress = elapsed / SPIN_DURATION;\n      const decay = Math.pow(1 - progress, 1.5);\n      groupRef.current.rotateOnAxis(spinAxis.current, spinSpeed.current * decay * delta);\n    } else {\n      if (settleStart.current === 0) {\n        settleStart.current = performance.now() / 1000;\n        settleStartQuat.current.copy(groupRef.current.quaternion);\n      }\n\n      const settleElapsed = performance.now() / 1000 - settleStart.current;\n      const t = Math.min(settleElapsed / SETTLE_DURATION, 1);\n      const eased = 1 - Math.pow(1 - t, 3);\n\n      groupRef.current.quaternion.copy(settleStartQuat.current).slerp(targetQuat.current, eased);\n\n      if (t >= 1) {\n        spinning.current = false;\n        groupRef.current.quaternion.copy(targetQuat.current);\n\n        if (!hasReported.current) {\n          hasReported.current = true;\n          flashing.current = true;\n          flashStart.current = performance.now() / 1000;\n          onResult(targetResult.current);\n        }\n      }\n    }\n  });\n\n  return (\n    <group ref={groupRef} position={[0, -0.1, 0]}>\n      <mesh geometry={geometry} material={materials} />\n      {edges.map((edge, i) => (\n        <mesh key={`edge-${i}`} geometry={edge.geo} position={edge.pos} quaternion={edge.quat}>\n          <meshBasicMaterial vertexColors />\n        </mesh>\n      ))}\n      {VERTS.map((v, i) => (\n        <mesh key={`corner-${i}`} geometry={sphereGeo} position={v}>\n          <meshBasicMaterial color={edgeBaseColor} />\n        </mesh>\n      ))}\n    </group>\n  );\n}\n","import { Canvas } from '@react-three/fiber';\nimport CubeDie from './CubeDie';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  onClick: () => void;\n  primary: string;\n  primaryDark: string;\n  fixedResult?: number;\n}\n\nexport default function D6Scene({ rollTrigger, onResult, onClick, primary, primaryDark, fixedResult }: Props) {\n  return (\n    <Canvas\n      flat\n      camera={{ position: [0, 0, 5.5], fov: 40 }}\n      gl={{ alpha: true, antialias: true }}\n      style={{ background: 'transparent', cursor: 'pointer' }}\n      onClick={onClick}\n    >\n      <ambientLight intensity={0.55} color=\"#ffffff\" />\n      <directionalLight position={[0, 0, 5]} intensity={0.45} color=\"#ffffff\" />\n      <directionalLight position={[3, 5, 5]} intensity={0.15} color=\"#ffffff\" />\n      <CubeDie\n        rollTrigger={rollTrigger}\n        onResult={onResult}\n        primary={primary}\n        primaryDark={primaryDark}\n        fixedResult={fixedResult}\n      />\n    </Canvas>\n  );\n}\n"],"names":["S","VERTS","EDGE_INDICES","FACE_NORMALS","THREE","FACE_VALUES","TARGET_QUATS","setFromAxisAngle","Math","PI","camDir","parseColor","color","rgbMatch","match","h","replace","n","parseInt","length","split","map","c","join","contrastText","bg","lum","r","g","b","s","pow","luminance","makeFaceTexture","num","primary","size","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","textColor","font","textAlign","textBaseline","fillText","String","tex","needsUpdate","makeEdgeCylinder","a","radius","baseColor","va","vb","distanceTo","geo","tA","tB","positions","attributes","position","colors","Float32Array","count","i","tint","getY","setAttribute","CubeDie","_ref","rollTrigger","onResult","primaryDark","fixedResult","groupRef","useRef","prevTrigger","hasReported","spinning","spinStart","spinAxis","normalize","spinSpeed","targetResult","targetQuat","settleStartQuat","settleStart","flashing","flashStart","edgeBaseColor","useMemo","ratio","m","round","concat","darken","worldNormal","geometry","materials","v","edges","_ref2","ai","bi","_objectSpread","mid","clone","add","multiplyScalar","dir","sub","pos","quat","setFromUnitVectors","edgeTransform","sphereGeo","useEffect","current","sx","random","sy","sz","set","floor","copy","useFrame","_","delta","tintFaces","flash","flashElapsed","performance","now","ft","min","scalePunch","sin","scale","setScalar","applyQuaternion","quaternion","dot","brightness","max","elapsed","progress","decay","rotateOnAxis","settleElapsed","t","eased","slerp","_jsxs","ref","children","_jsx","material","edge","vertexColors","D6Scene","onClick","Canvas","flat","camera","fov","gl","alpha","antialias","style","background","cursor","intensity"],"sourceRoot":""}