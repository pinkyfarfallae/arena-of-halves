"use strict";(self.webpackChunkarena_of_halves=self.webpackChunkarena_of_halves||[]).push([[895],{895(e,r,t){t.r(r),t.d(r,{default:()=>B});var n=t(37),o=t(555),c=t(43),u=t(230),a=t(408),s=t(579);const i=[1,2,3,4],l=1.3,f=Math.sqrt(3),m=Math.sqrt(6),p=[0,2.6/f,l*m/6],h=[-l,-l/f,l*m/6],w=[l,-l/f,l*m/6],d=[0,0,-l*m/2],y=[[p,h,w],[p,d,h],[p,w,d],[h,d,w]];const x=y.map(e=>function(e,r,t){const n=new a.Vector3(...e),o=new a.Vector3(...r),c=new a.Vector3(...t);return o.sub(n).cross(c.sub(new a.Vector3(...e))).normalize()}(e[0],e[1],e[2]));function M(e){const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r)return[+r[1],+r[2],+r[3]];const t=e.replace("#",""),n=parseInt(3===t.length?t.split("").map(e=>e+e).join(""):t,16);return[n>>16&255,n>>8&255,255&n]}function g(e){const r=function(e){const[r,t,n]=M(e).map(e=>{const r=e/255;return r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)});return.2126*r+.7152*t+.0722*n}(e);return r>.85?e:r>.4?"#000000":"#ffffff"}function R(e,r){const t=512,n=document.createElement("canvas");n.width=t,n.height=t;const o=n.getContext("2d");o.fillStyle=r,o.fillRect(0,0,t,t);const c=g(r);o.fillStyle=c,o.font="bold 140px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillText(String(e),256,1024/3);const u=new a.CanvasTexture(n);return u.needsUpdate=!0,u}const b=[p,h,w,d],V=Math.min(...b.map(e=>e[1])),A=Math.max(...b.map(e=>e[1]));function j(e,r,t,n){const o=new a.Vector3(...e),c=new a.Vector3(...r),u=o.distanceTo(c),s=new a.CylinderGeometry(t,t,u,8,1),i=(e[1]-V)/(A-V),l=(r[1]-V)/(A-V),f=s.attributes.position,m=new Float32Array(3*f.count);for(let a=0;a<f.count;a++){const e=.9+.45*(i+(l-i)*((f.getY(a)+u/2)/u));m[3*a]=n.r*e,m[3*a+1]=n.g*e,m[3*a+2]=n.b*e}return s.setAttribute("color",new a.BufferAttribute(m,3)),s}const k=[[p,h],[p,w],[p,d],[h,w],[h,d],[w,d]];function q(e,r){const t=new a.BufferGeometry,n=new Float32Array([...e[0],...e[1],...e[2]]),o=new Float32Array([r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z]),c=new Float32Array([.5,1,0,0,1,0]);return t.setAttribute("position",new a.BufferAttribute(n,3)),t.setAttribute("normal",new a.BufferAttribute(o,3)),t.setAttribute("uv",new a.BufferAttribute(c,2)),t}const v=y.map((e,r)=>{const t=x[r],n=(e[0][0]+e[1][0]+e[2][0])/3,o=(e[0][1]+e[1][1]+e[2][1])/3,c=(e[0][2]+e[1][2]+e[2][2])/3,u=new a.Vector3(e[0][0]-n,e[0][1]-o,e[0][2]-c).normalize(),s=(new a.Vector3).crossVectors(u,t).normalize(),i=(new a.Matrix4).makeBasis(s,u,t).transpose();return(new a.Quaternion).setFromRotationMatrix(i)});function z(e){let{rollTrigger:r,onResult:t,primary:n,primaryDark:l,fixedResult:f}=e;const m=(0,c.useRef)(null),p=(0,c.useRef)(0),h=(0,c.useRef)(!1),w=(0,c.useRef)(!1),d=(0,c.useRef)(0),g=(0,c.useRef)(new a.Vector3(1,1,0).normalize()),b=(0,c.useRef)(8),V=(0,c.useRef)(0),A=(0,c.useRef)(new a.Quaternion),z=(0,c.useRef)(new a.Quaternion),B=(0,c.useRef)(0),C=(0,c.useRef)(!1),F=(0,c.useRef)(0),S=(0,c.useMemo)(()=>new a.Color(function(e,r){const[t,n,o]=M(e),c=e=>Math.round(e*(1-r));return"rgb(".concat(c(t),",").concat(c(n),",").concat(c(o),")")}(n,.1)),[n]),T=(0,c.useRef)([null,null,null,null]),Q=(0,c.useRef)(new a.Vector3),D=new a.Vector3(0,0,1),_=(0,c.useMemo)(()=>y.map((e,r)=>({geometry:q(e,x[r]),texture:R(i[r],n)})),[n]),L=(0,c.useMemo)(()=>k.map(e=>{let[r,t]=e;return(0,o.A)({geo:j(r,t,.035,S)},function(e,r){const t=new a.Vector3(...e),n=new a.Vector3(...r),o=t.clone().add(n).multiplyScalar(.5),c=n.clone().sub(t).normalize();return{pos:o,quat:(new a.Quaternion).setFromUnitVectors(new a.Vector3(0,1,0),c)}}(r,t))}),[S]);(0,c.useEffect)(()=>{if(0===r)return;if(r===p.current)return;p.current=r,h.current=!1,w.current=!0,d.current=0;const e=Math.random()<.5?-1:1,t=Math.random()<.5?-1:1,n=Math.random()<.5?-1:1;g.current.set(e*(.5+.5*Math.random()),t*(.5+.5*Math.random()),n*(.5+.5*Math.random())).normalize(),b.current=14+4*Math.random(),V.current=null!==f&&void 0!==f?f:Math.floor(4*Math.random())+1;const o=i.indexOf(V.current);A.current.copy(v[o])},[r]);return(0,u.D)((e,r)=>{if(!m.current)return;if((()=>{if(!m.current)return;let e=0;if(C.current&&F.current>0){const r=performance.now()/1e3-F.current,t=Math.min(r/.3,1);e=1-t,t>=1&&(C.current=!1);const n=1+.08*Math.sin(t*Math.PI);m.current.scale.setScalar(n)}for(let r=0;r<4;r++){const t=T.current[r];if(!t)continue;Q.current.copy(x[r]).applyQuaternion(m.current.quaternion);const n=Q.current.dot(D);let o=.35+.9*Math.max(0,n);e>0&&(o+=(2-o)*e*.6),t.material.color.setScalar(o)}})(),!w.current)return;0===d.current&&(d.current=performance.now()/1e3,B.current=0);const n=performance.now()/1e3-d.current;if(n<1.5){const e=n/1.5,t=Math.pow(1-e,1.5);m.current.rotateOnAxis(g.current,b.current*t*r)}else{0===B.current&&(B.current=performance.now()/1e3,z.current.copy(m.current.quaternion));const e=performance.now()/1e3-B.current,r=Math.min(e/.3,1),n=1-Math.pow(1-r,3);m.current.quaternion.copy(z.current).slerp(A.current,n),r>=1&&(w.current=!1,m.current.quaternion.copy(A.current),h.current||(h.current=!0,C.current=!0,F.current=performance.now()/1e3,t(V.current)))}}),(0,s.jsxs)("group",{ref:m,position:[0,-.35,0],children:[_.map((e,r)=>(0,s.jsx)("mesh",{ref:e=>{T.current[r]=e},geometry:e.geometry,children:(0,s.jsx)("meshBasicMaterial",{map:e.texture})},r)),L.map((e,r)=>(0,s.jsx)("mesh",{geometry:e.geo,position:e.pos,quaternion:e.quat,children:(0,s.jsx)("meshBasicMaterial",{vertexColors:!0})},"edge-".concat(r)))]})}function B(e){let{rollTrigger:r,onResult:t,onClick:o,primary:c,primaryDark:u,fixedResult:a}=e;return(0,s.jsxs)(n.Hl,{flat:!0,camera:{position:[0,0,5.5],fov:40},gl:{alpha:!0,antialias:!0},style:{background:"transparent",cursor:"pointer"},onClick:o,children:[(0,s.jsx)("ambientLight",{intensity:.55,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[0,0,5],intensity:.45,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[3,5,5],intensity:.15,color:"#ffffff"}),(0,s.jsx)(z,{rollTrigger:r,onResult:t,primary:c,primaryDark:u,fixedResult:a})]})}}}]);
//# sourceMappingURL=895.4e3212d8.chunk.js.map