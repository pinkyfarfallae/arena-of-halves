"use strict";(self.webpackChunkarena_of_halves=self.webpackChunkarena_of_halves||[]).push([[369],{369(e,r,t){t.r(r),t.d(r,{default:()=>q});var n=t(37),o=t(555),c=t(43),a=t(230),u=t(408),s=t(579);const i=1.4,f=[0,i,0],l=[0,-i,0],m=[i,0,0],p=[-i,0,0],h=[0,0,i],w=[0,0,-i],d=[f,l,m,p,h,w],y=[[f,h,m],[f,p,h],[f,m,w],[f,w,p],[l,m,h],[l,h,p],[l,w,m],[l,p,w]],x=[1,2,3,4,5,6,7,8];const g=y.map(e=>function(e,r,t){const n=new u.Vector3(...e),o=new u.Vector3(...r),c=new u.Vector3(...t);return o.sub(n).cross(c.sub(new u.Vector3(...e))).normalize()}(e[0],e[1],e[2])),M=[[f,m],[f,p],[f,h],[f,w],[l,m],[l,p],[l,h],[l,w],[m,h],[h,p],[p,w],[w,m]],R={};y.forEach((e,r)=>{const t=g[r],n=(e[0][0]+e[1][0]+e[2][0])/3,o=(e[0][1]+e[1][1]+e[2][1])/3,c=(e[0][2]+e[1][2]+e[2][2])/3,a=new u.Vector3(e[0][0]-n,e[0][1]-o,e[0][2]-c).normalize(),s=(new u.Vector3).crossVectors(a,t).normalize(),i=(new u.Matrix4).makeBasis(s,a,t).transpose();R[x[r]]=(new u.Quaternion).setFromRotationMatrix(i)});const b=new u.Vector3(0,0,1),A=Math.min(...d.map(e=>e[1])),V=Math.max(...d.map(e=>e[1]));function j(e){const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r)return[+r[1],+r[2],+r[3]];const t=e.replace("#",""),n=parseInt(3===t.length?t.split("").map(e=>e+e).join(""):t,16);return[n>>16&255,n>>8&255,255&n]}function k(e){const r=function(e){const[r,t,n]=j(e).map(e=>{const r=e/255;return r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)});return.2126*r+.7152*t+.0722*n}(e);return r>.85?e:r>.4?"#000000":"#ffffff"}function B(e,r){const t=new u.BufferGeometry,n=new Float32Array([...e[0],...e[1],...e[2]]),o=new Float32Array([r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z]),c=new Float32Array([.5,1,0,0,1,0]);return t.setAttribute("position",new u.BufferAttribute(n,3)),t.setAttribute("normal",new u.BufferAttribute(o,3)),t.setAttribute("uv",new u.BufferAttribute(c,2)),t}function z(e,r){const t=512,n=document.createElement("canvas");n.width=t,n.height=t;const o=n.getContext("2d");o.fillStyle=r,o.fillRect(0,0,t,t);const c=k(r);o.fillStyle=c,o.font="bold 140px sans-serif",o.textAlign="center",o.textBaseline="middle",o.fillText(String(e),256,1024/3);const a=new u.CanvasTexture(n);return a.needsUpdate=!0,a}function C(e,r,t,n){const o=new u.Vector3(...e),c=new u.Vector3(...r),a=o.distanceTo(c),s=new u.CylinderGeometry(t,t,a,8,1),i=(e[1]-A)/(V-A),f=(r[1]-A)/(V-A),l=s.attributes.position,m=new Float32Array(3*l.count);for(let u=0;u<l.count;u++){const e=.5+.45*(i+(f-i)*((l.getY(u)+a/2)/a));m[3*u]=n.r*e,m[3*u+1]=n.g*e,m[3*u+2]=n.b*e}return s.setAttribute("color",new u.BufferAttribute(m,3)),s}function v(e){let{rollTrigger:r,onResult:t,primary:n,primaryDark:i}=e;const f=(0,c.useRef)(null),l=(0,c.useRef)(0),m=(0,c.useRef)(!1),p=(0,c.useRef)(!1),h=(0,c.useRef)(0),w=(0,c.useRef)(new u.Vector3(1,1,0).normalize()),A=(0,c.useRef)(8),V=(0,c.useRef)(0),k=(0,c.useRef)(new u.Quaternion),v=(0,c.useRef)(new u.Quaternion),q=(0,c.useRef)(0),S=(0,c.useRef)(!1),F=(0,c.useRef)(0),T=(0,c.useMemo)(()=>new u.Color(function(e,r){const[t,n,o]=j(e),c=e=>Math.round(e*(1-r));return"rgb(".concat(c(t),",").concat(c(n),",").concat(c(o),")")}(n,.02)),[n]),Q=(0,c.useRef)(new Array(8).fill(null)),D=(0,c.useRef)(new u.Vector3),_=(0,c.useMemo)(()=>y.map((e,r)=>({geometry:B(e,g[r]),texture:z(x[r],n)})),[n]),E=(0,c.useMemo)(()=>M.map(e=>{let[r,t]=e;return(0,o.A)({geo:C(r,t,.035,T)},function(e,r){const t=new u.Vector3(...e),n=new u.Vector3(...r),o=t.clone().add(n).multiplyScalar(.5),c=n.clone().sub(t).normalize();return{pos:o,quat:(new u.Quaternion).setFromUnitVectors(new u.Vector3(0,1,0),c)}}(r,t))}),[T]),G=(0,c.useMemo)(()=>new u.SphereGeometry(.035,8,8),[]);(0,c.useEffect)(()=>{if(0===r)return;if(r===l.current)return;l.current=r,m.current=!1,p.current=!0,h.current=0;const e=Math.random()<.5?-1:1,t=Math.random()<.5?-1:1,n=Math.random()<.5?-1:1;w.current.set(e*(.5+.5*Math.random()),t*(.5+.5*Math.random()),n*(.5+.5*Math.random())).normalize(),A.current=14+4*Math.random(),V.current=Math.floor(8*Math.random())+1,k.current.copy(R[V.current])},[r]);return(0,a.D)((e,r)=>{if(!f.current)return;if((()=>{if(!f.current)return;let e=0;if(S.current&&F.current>0){const r=performance.now()/1e3-F.current,t=Math.min(r/.3,1);e=1-t,t>=1&&(S.current=!1);const n=1+.08*Math.sin(t*Math.PI);f.current.scale.setScalar(n)}for(let r=0;r<8;r++){const t=Q.current[r];if(!t)continue;D.current.copy(g[r]).applyQuaternion(f.current.quaternion);const n=D.current.dot(b);let o=.55+.45*Math.max(0,n);e>0&&(o+=(2-o)*e*.6),t.material.color.setScalar(o)}})(),!p.current)return;0===h.current&&(h.current=performance.now()/1e3,q.current=0);const n=performance.now()/1e3-h.current;if(n<1.5){const e=n/1.5,t=Math.pow(1-e,1.5);f.current.rotateOnAxis(w.current,A.current*t*r)}else{0===q.current&&(q.current=performance.now()/1e3,v.current.copy(f.current.quaternion));const e=performance.now()/1e3-q.current,r=Math.min(e/.3,1),n=1-Math.pow(1-r,3);f.current.quaternion.copy(v.current).slerp(k.current,n),r>=1&&(p.current=!1,f.current.quaternion.copy(k.current),m.current||(m.current=!0,S.current=!0,F.current=performance.now()/1e3,t(V.current)))}}),(0,s.jsxs)("group",{ref:f,position:[0,-.15,0],children:[_.map((e,r)=>(0,s.jsx)("mesh",{ref:e=>{Q.current[r]=e},geometry:e.geometry,children:(0,s.jsx)("meshBasicMaterial",{map:e.texture})},r)),E.map((e,r)=>(0,s.jsx)("mesh",{geometry:e.geo,position:e.pos,quaternion:e.quat,children:(0,s.jsx)("meshBasicMaterial",{vertexColors:!0})},"edge-".concat(r))),d.map((e,r)=>(0,s.jsx)("mesh",{geometry:G,position:e,children:(0,s.jsx)("meshBasicMaterial",{color:T})},"corner-".concat(r)))]})}function q(e){let{rollTrigger:r,onResult:t,onClick:o,primary:c,primaryDark:a,fixedResult:u}=e;return(0,s.jsxs)(n.Hl,{flat:!0,camera:{position:[0,0,5.5],fov:40},gl:{alpha:!0,antialias:!0},style:{background:"transparent",cursor:"pointer"},onClick:o,children:[(0,s.jsx)("ambientLight",{intensity:.55,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[0,0,5],intensity:.45,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[3,5,5],intensity:.15,color:"#ffffff"}),(0,s.jsx)(v,{rollTrigger:r,onResult:t,primary:c,primaryDark:a})]})}}}]);
//# sourceMappingURL=369.dd6e568c.chunk.js.map