"use strict";(self.webpackChunkarena_of_halves=self.webpackChunkarena_of_halves||[]).push([[2],{2(e,r,t){t.r(r),t.d(r,{default:()=>S});var n=t(37),o=t(555),c=t(43),a=t(230),u=t(408),s=t(579);const i=(1+Math.sqrt(5))/2,l=1/i,f=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1],[0,l,i],[0,l,-i],[0,-l,i],[0,-l,-i],[l,i,0],[l,-i,0],[-l,i,0],[-l,-i,0],[i,0,l],[i,0,-l],[-i,0,l],[-i,0,-l]].map(e=>[.9*e[0],.9*e[1],.9*e[2]]),m=[[0,8,10,2,16],[0,16,17,1,12],[0,12,14,4,8],[1,17,3,11,9],[1,9,5,14,12],[2,10,6,15,13],[2,13,3,17,16],[3,13,15,7,11],[4,14,5,19,18],[4,18,6,10,8],[5,9,11,7,19],[6,18,19,7,15]],p=m.map(e=>e.map(e=>f[e])),h=12;const d=p.map(e=>function(e,r,t){const n=new u.Vector3(...e),o=new u.Vector3(...r),c=new u.Vector3(...t);return o.sub(n).cross(c.sub(new u.Vector3(...e))).normalize()}(e[0],e[1],e[2])),w=p.map(e=>{const r=e.reduce((e,r)=>e+r[0],0)/5,t=e.reduce((e,r)=>e+r[1],0)/5,n=e.reduce((e,r)=>e+r[2],0)/5;return new u.Vector3(r,t,n)}),y=(()=>{const e=new Array(h).fill(0),r=new Set;let t=1;for(let n=0;n<h;n++){if(r.has(n))continue;let o=-1,c=1/0;for(let e=n+1;e<h;e++){if(r.has(e))continue;const t=w[n].dot(w[e]);t<c&&(c=t,o=e)}e[n]=t,e[o]=13-t,r.add(n),r.add(o),t++}return e})(),M=(()=>{const e=new Set,r=[];return m.forEach(t=>{for(let n=0;n<5;n++){const o=t[n],c=t[(n+1)%5],a="".concat(Math.min(o,c),"-").concat(Math.max(o,c));e.has(a)||(e.add(a),r.push([f[o],f[c]]))}}),r})(),g=Array.from({length:5},(e,r)=>{const t=-Math.PI/2+2*Math.PI*r/5;return[.5+.45*Math.cos(t),.5+.45*Math.sin(t)]}),x=[.5,.5],b={};p.forEach((e,r)=>{const t=d[r],n=w[r],o=new u.Vector3(e[0][0]-n.x,e[0][1]-n.y,e[0][2]-n.z).normalize(),c=(new u.Vector3).crossVectors(o,t).normalize(),a=(new u.Matrix4).makeBasis(c,o,t).transpose();b[y[r]]=(new u.Quaternion).setFromRotationMatrix(a)});const R=new u.Vector3(0,0,1),A=Math.min(...f.map(e=>e[1])),V=Math.max(...f.map(e=>e[1]));function j(e){const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r)return[+r[1],+r[2],+r[3]];const t=e.replace("#",""),n=parseInt(3===t.length?t.split("").map(e=>e+e).join(""):t,16);return[n>>16&255,n>>8&255,255&n]}function k(e){const r=function(e){const[r,t,n]=j(e).map(e=>{const r=e/255;return r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)});return.2126*r+.7152*t+.0722*n}(e);return r>.85?e:r>.4?"#000000":"#ffffff"}function z(e,r){const t=new u.BufferGeometry,n=e.reduce((e,r)=>e+r[0],0)/5,o=e.reduce((e,r)=>e+r[1],0)/5,c=e.reduce((e,r)=>e+r[2],0)/5,a=[],s=[],i=[];for(let u=0;u<5;u++){const t=(u+1)%5;a.push(n,o,c,...e[u],...e[t]),s.push(r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z),i.push(...x,...g[u],...g[t])}return t.setAttribute("position",new u.BufferAttribute(new Float32Array(a),3)),t.setAttribute("normal",new u.BufferAttribute(new Float32Array(s),3)),t.setAttribute("uv",new u.BufferAttribute(new Float32Array(i),2)),t}function B(e,r){const t=512,n=document.createElement("canvas");n.width=t,n.height=t;const o=n.getContext("2d");o.fillStyle=r,o.fillRect(0,0,t,t),o.save(),o.translate(256,256),o.scale(-1,-1);const c=k(r);o.fillStyle=c,o.font="bold ".concat(e.length>1?100:130,"px sans-serif"),o.textAlign="center",o.textBaseline="middle",o.fillText(e,0,0),o.restore();const a=new u.CanvasTexture(n);return a.needsUpdate=!0,a}function v(e,r,t,n){const o=new u.Vector3(...e),c=new u.Vector3(...r),a=o.distanceTo(c),s=new u.CylinderGeometry(t,t,a,8,1),i=(e[1]-A)/(V-A),l=(r[1]-A)/(V-A),f=s.attributes.position,m=new Float32Array(3*f.count);for(let u=0;u<f.count;u++){const e=.5+.45*(i+(l-i)*((f.getY(u)+a/2)/a));m[3*u]=n.r*e,m[3*u+1]=n.g*e,m[3*u+2]=n.b*e}return s.setAttribute("color",new u.BufferAttribute(m,3)),s}function C(e){let{rollTrigger:r,onResult:t,primary:n}=e;const i=(0,c.useRef)(null),l=(0,c.useRef)(r),m=(0,c.useRef)(!1),w=(0,c.useRef)(!1),g=(0,c.useRef)(0),x=(0,c.useRef)(new u.Vector3(1,1,0).normalize()),A=(0,c.useRef)(8),V=(0,c.useRef)(0),k=(0,c.useRef)(new u.Quaternion),C=(0,c.useRef)(new u.Quaternion),S=(0,c.useRef)(0),q=(0,c.useRef)(!1),F=(0,c.useRef)(0),T=(0,c.useMemo)(()=>new u.Color(function(e,r){const[t,n,o]=j(e),c=e=>Math.round(e*(1-r));return"rgb(".concat(c(t),",").concat(c(n),",").concat(c(o),")")}(n,.1)),[n]),Q=(0,c.useRef)(new Array(h).fill(null)),E=(0,c.useRef)(new u.Vector3),I=(0,c.useMemo)(()=>p.map((e,r)=>({geometry:z(e,d[r]),texture:B(String(y[r]),n)})),[n]),_=(0,c.useMemo)(()=>M.map(e=>{let[r,t]=e;return(0,o.A)({geo:v(r,t,.03,T)},function(e,r){const t=new u.Vector3(...e),n=new u.Vector3(...r),o=t.clone().add(n).multiplyScalar(.5),c=n.clone().sub(t).normalize();return{pos:o,quat:(new u.Quaternion).setFromUnitVectors(new u.Vector3(0,1,0),c)}}(r,t))}),[T]),D=(0,c.useMemo)(()=>new u.SphereGeometry(.03,8,8),[]);(0,c.useEffect)(()=>{if(0===r)return;if(r===l.current)return;l.current=r,m.current=!1,w.current=!0,g.current=0;const e=Math.random()<.5?-1:1,t=Math.random()<.5?-1:1,n=Math.random()<.5?-1:1;x.current.set(e*(.5+.5*Math.random()),t*(.5+.5*Math.random()),n*(.5+.5*Math.random())).normalize(),A.current=14+4*Math.random(),V.current=Math.floor(Math.random()*h)+1,k.current.copy(b[V.current])},[r]);return(0,a.D)((e,r)=>{if(!i.current)return;if((()=>{if(!i.current)return;let e=0;if(q.current&&F.current>0){const r=performance.now()/1e3-F.current,t=Math.min(r/.3,1);e=1-t,t>=1&&(q.current=!1);const n=1+.15*Math.sin(t*Math.PI);i.current.scale.setScalar(n)}for(let r=0;r<h;r++){const t=Q.current[r];if(!t)continue;E.current.copy(d[r]).applyQuaternion(i.current.quaternion);const n=E.current.dot(R);let o=.55+.45*Math.max(0,n);e>0&&(o+=(2-o)*e*.6),t.material.color.setScalar(o)}})(),!w.current)return;0===g.current&&(g.current=performance.now()/1e3,S.current=0);const n=performance.now()/1e3-g.current;if(n<1.5){const e=n/1.5,t=Math.pow(1-e,1.5);i.current.rotateOnAxis(x.current,A.current*t*r)}else{0===S.current&&(S.current=performance.now()/1e3,C.current.copy(i.current.quaternion));const e=performance.now()/1e3-S.current,r=Math.min(e/.3,1),n=1-Math.pow(1-r,3);i.current.quaternion.copy(C.current).slerp(k.current,n),r>=1&&(w.current=!1,i.current.quaternion.copy(k.current),m.current||(m.current=!0,q.current=!0,F.current=performance.now()/1e3,t(V.current)))}}),(0,s.jsxs)("group",{ref:i,position:[0,-.15,0],children:[I.map((e,r)=>(0,s.jsx)("mesh",{ref:e=>{Q.current[r]=e},geometry:e.geometry,children:(0,s.jsx)("meshBasicMaterial",{map:e.texture})},r)),_.map((e,r)=>(0,s.jsx)("mesh",{geometry:e.geo,position:e.pos,quaternion:e.quat,children:(0,s.jsx)("meshBasicMaterial",{vertexColors:!0})},"edge-".concat(r))),f.map((e,r)=>(0,s.jsx)("mesh",{geometry:D,position:e,children:(0,s.jsx)("meshBasicMaterial",{color:T})},"corner-".concat(r)))]})}function S(e){let{rollTrigger:r,onResult:t,onClick:o,primary:c,primaryDark:a}=e;return(0,s.jsxs)(n.Hl,{flat:!0,camera:{position:[0,0,5.5],fov:40},gl:{alpha:!0,antialias:!0},style:{background:"transparent",cursor:"pointer"},onClick:o,children:[(0,s.jsx)("ambientLight",{intensity:.55,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[0,0,5],intensity:.45,color:"#ffffff"}),(0,s.jsx)("directionalLight",{position:[3,5,5],intensity:.15,color:"#ffffff"}),(0,s.jsx)(C,{rollTrigger:r,onResult:t,primary:c,primaryDark:a})]})}}}]);
//# sourceMappingURL=2.e56758e0.chunk.js.map