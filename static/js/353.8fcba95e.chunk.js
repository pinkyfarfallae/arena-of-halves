"use strict";(self.webpackChunkarena_of_halves=self.webpackChunkarena_of_halves||[]).push([[353],{353(e,t,r){r.r(t),r.d(t,{default:()=>P});var n=r(37),o=r(555),c=r(43),a=r(230),s=r(408),u=r(579);const i=1.55,l=[.8,.4,0,-.4,-.8],f=l.map(e=>i*e),m=l.map(e=>i*Math.sqrt(1-e*e)),p=[0,Math.PI/10,0,Math.PI/10,0],h=2*Math.PI/10,w=[0,i,0],d=[0,-i,0],M=[];for(let _=0;_<5;_++){const e=[];for(let t=0;t<10;t++){const r=t*h+p[_];e.push([m[_]*Math.cos(r),f[_],m[_]*Math.sin(r)])}M.push(e)}const y=[w,...M.flat(),d];function g(e,t){return 1+10*e+(t%10+10)%10}const x=100,b=[];for(let _=0;_<10;_++)b.push([0,g(0,_+1),g(0,_)]);for(let _=0;_<4;_++){const e=p[_+1]>p[_]?0:1;for(let t=0;t<10;t++){const r=t+e;b.push([g(_,t),g(_+1,r),g(_,t+1)]),b.push([g(_+1,r),g(_+1,r+1),g(_,t+1)])}}for(let _=0;_<10;_++)b.push([51,g(4,_),g(4,_+1)]);const R=b.map(e=>e.map(e=>y[e]));const V=R.map(e=>function(e,t,r){const n=new s.Vector3(...e),o=new s.Vector3(...t),c=new s.Vector3(...r);return o.sub(n).cross(c.sub(new s.Vector3(...e))).normalize()}(e[0],e[1],e[2])),A=R.map(e=>new s.Vector3((e[0][0]+e[1][0]+e[2][0])/3,(e[0][1]+e[1][1]+e[2][1])/3,(e[0][2]+e[1][2]+e[2][2])/3));R.forEach((e,t)=>{if(A[t].dot(V[t])<0){const r=e[1];e[1]=e[2],e[2]=r;const n=b[t][1];b[t][1]=b[t][2],b[t][2]=n,V[t].negate()}});const j=Array.from({length:x},(e,t)=>t+1),z=(()=>{const e=new Set,t=[];return b.forEach(r=>{for(let n=0;n<3;n++){const o=r[n],c=r[(n+1)%3],a="".concat(Math.min(o,c),"-").concat(Math.max(o,c));e.has(a)||(e.add(a),t.push([y[o],y[c]]))}}),t})(),k=R.map((e,t)=>{const r=V[t],n=new s.Vector3(0,1,0).sub(r.clone().multiplyScalar(r.y));return n.lengthSq()<.001&&n.set(1,0,0),n.normalize()}),B={};R.forEach((e,t)=>{const r=V[t],n=k[t],o=(new s.Vector3).crossVectors(n,r).normalize(),c=(new s.Matrix4).makeBasis(o,n,r).transpose();B[j[t]]=(new s.Quaternion).setFromRotationMatrix(c)});const S=new s.Vector3(0,0,1),q=Math.min(...y.map(e=>e[1])),C=Math.max(...y.map(e=>e[1]));function v(e){const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t)return[+t[1],+t[2],+t[3]];const r=e.replace("#",""),n=parseInt(3===r.length?r.split("").map(e=>e+e).join(""):r,16);return[n>>16&255,n>>8&255,255&n]}function F(e){const t=function(e){const[t,r,n]=v(e).map(e=>{const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*t+.7152*r+.0722*n}(e);return t>.85?e:t>.4?"#000000":"#ffffff"}function T(e,t,r,n){const o=new s.BufferGeometry,c=new Float32Array([...e[0],...e[1],...e[2]]),a=new Float32Array([t.x,t.y,t.z,t.x,t.y,t.z,t.x,t.y,t.z]),u=(new s.Vector3).crossVectors(n,t).normalize(),i=e.map(e=>{const t=new s.Vector3(e[0]-r.x,e[1]-r.y,e[2]-r.z);return[t.dot(u),t.dot(n)]}),l=.45/(Math.max(...i.flatMap(e=>[Math.abs(e[0]),Math.abs(e[1])]))||1),f=new Float32Array(6);for(let s=0;s<3;s++)f[2*s]=.5+i[s][0]*l,f[2*s+1]=.5+i[s][1]*l;return o.setAttribute("position",new s.BufferAttribute(c,3)),o.setAttribute("normal",new s.BufferAttribute(a,3)),o.setAttribute("uv",new s.BufferAttribute(f,2)),o}function E(e,t){const r=256,n=document.createElement("canvas");n.width=r,n.height=r;const o=n.getContext("2d");o.fillStyle=t,o.fillRect(0,0,r,r);const c=F(t);o.fillStyle=c;const a=e.length>2?32:e.length>1?42:56;o.font="bold ".concat(a,"px sans-serif"),o.textAlign="center",o.textBaseline="middle",o.fillText(e,128,128);const u=new s.CanvasTexture(n);return u.needsUpdate=!0,u}function I(e,t,r,n){const o=new s.Vector3(...e),c=new s.Vector3(...t),a=o.distanceTo(c),u=new s.CylinderGeometry(r,r,a,4,1),i=(e[1]-q)/(C-q),l=(t[1]-q)/(C-q),f=u.attributes.position,m=new Float32Array(3*f.count);for(let s=0;s<f.count;s++){const e=.5+.45*(i+(l-i)*((f.getY(s)+a/2)/a));m[3*s]=n.r*e,m[3*s+1]=n.g*e,m[3*s+2]=n.b*e}return u.setAttribute("color",new s.BufferAttribute(m,3)),u}function Q(e){let{rollTrigger:t,onResult:r,primary:n}=e;const i=(0,c.useRef)(null),l=(0,c.useRef)(t),f=(0,c.useRef)(!1),m=(0,c.useRef)(!1),p=(0,c.useRef)(0),h=(0,c.useRef)(new s.Vector3(1,1,0).normalize()),w=(0,c.useRef)(8),d=(0,c.useRef)(0),M=(0,c.useRef)(new s.Quaternion),g=(0,c.useRef)(new s.Quaternion),b=(0,c.useRef)(0),q=(0,c.useRef)(!1),C=(0,c.useRef)(0),F=(0,c.useMemo)(()=>new s.Color(function(e,t){const[r,n,o]=v(e),c=e=>Math.round(e*(1-t));return"rgb(".concat(c(r),",").concat(c(n),",").concat(c(o),")")}(n,.3)),[n]),Q=(0,c.useRef)(new Array(x).fill(null)),P=(0,c.useRef)(new s.Vector3),_=(0,c.useMemo)(()=>R.map((e,t)=>({geometry:T(e,V[t],A[t],k[t]),texture:E(String(j[t]),n)})),[n]),D=(0,c.useMemo)(()=>z.map(e=>{let[t,r]=e;return(0,o.A)({geo:I(t,r,.012,F)},function(e,t){const r=new s.Vector3(...e),n=new s.Vector3(...t),o=r.clone().add(n).multiplyScalar(.5),c=n.clone().sub(r).normalize();return{pos:o,quat:(new s.Quaternion).setFromUnitVectors(new s.Vector3(0,1,0),c)}}(t,r))}),[F]),G=(0,c.useMemo)(()=>new s.SphereGeometry(.012,4,4),[]);(0,c.useEffect)(()=>{if(0===t)return;if(t===l.current)return;l.current=t,f.current=!1,m.current=!0,p.current=0;const e=Math.random()<.5?-1:1,r=Math.random()<.5?-1:1,n=Math.random()<.5?-1:1;h.current.set(e*(.5+.5*Math.random()),r*(.5+.5*Math.random()),n*(.5+.5*Math.random())).normalize(),w.current=14+4*Math.random(),d.current=Math.floor(Math.random()*x)+1,M.current.copy(B[d.current])},[t]);return(0,a.D)((e,t)=>{if(!i.current)return;if((()=>{if(!i.current)return;let e=0;if(q.current&&C.current>0){const t=performance.now()/1e3-C.current,r=Math.min(t/.3,1);e=1-r,r>=1&&(q.current=!1);const n=1+.15*Math.sin(r*Math.PI);i.current.scale.setScalar(n)}const t=f.current&&!m.current,r=t?d.current-1:-1;for(let n=0;n<x;n++){const o=Q.current[n];if(!o)continue;P.current.copy(V[n]).applyQuaternion(i.current.quaternion);const c=P.current.dot(S);let a=.55+.45*Math.max(0,c);e>0&&(a+=(2-a)*e*.6),t&&n!==r&&(a*=.5),o.material.color.setScalar(a)}})(),!m.current)return;0===p.current&&(p.current=performance.now()/1e3,b.current=0);const n=performance.now()/1e3-p.current;if(n<1.5){const e=n/1.5,r=Math.pow(1-e,1.5);i.current.rotateOnAxis(h.current,w.current*r*t)}else{0===b.current&&(b.current=performance.now()/1e3,g.current.copy(i.current.quaternion));const e=performance.now()/1e3-b.current,t=Math.min(e/.3,1),n=1-Math.pow(1-t,3);i.current.quaternion.copy(g.current).slerp(M.current,n),t>=1&&(m.current=!1,i.current.quaternion.copy(M.current),f.current||(f.current=!0,q.current=!0,C.current=performance.now()/1e3,r(d.current)))}}),(0,u.jsxs)("group",{ref:i,position:[0,-.15,0],children:[_.map((e,t)=>(0,u.jsx)("mesh",{ref:e=>{Q.current[t]=e},geometry:e.geometry,children:(0,u.jsx)("meshBasicMaterial",{map:e.texture})},t)),D.map((e,t)=>(0,u.jsx)("mesh",{geometry:e.geo,position:e.pos,quaternion:e.quat,children:(0,u.jsx)("meshBasicMaterial",{vertexColors:!0})},"edge-".concat(t))),y.map((e,t)=>(0,u.jsx)("mesh",{geometry:G,position:e,children:(0,u.jsx)("meshBasicMaterial",{color:F})},"corner-".concat(t)))]})}function P(e){let{rollTrigger:t,onResult:r,onClick:o,primary:c,primaryDark:a}=e;return(0,u.jsxs)(n.Hl,{flat:!0,camera:{position:[0,0,5.5],fov:40},gl:{alpha:!0,antialias:!0},style:{background:"transparent",cursor:"pointer"},onClick:o,children:[(0,u.jsx)("ambientLight",{intensity:.55,color:"#ffffff"}),(0,u.jsx)("directionalLight",{position:[0,0,5],intensity:.45,color:"#ffffff"}),(0,u.jsx)("directionalLight",{position:[3,5,5],intensity:.15,color:"#ffffff"}),(0,u.jsx)(Q,{rollTrigger:t,onResult:r,primary:c,primaryDark:a})]})}}}]);
//# sourceMappingURL=353.8fcba95e.chunk.js.map