{"version":3,"file":"static/js/1.641a52cf.chunk.js","mappings":"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","sources":["components/DiceRoller/D20/IcosahedronDie.tsx","components/DiceRoller/D20/D20Scene.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react';\nimport { useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  primary: string;\n  primaryDark: string;\n}\n\n/* ── Geometry ──\n   Regular icosahedron: 12 vertices, 20 triangular faces, 30 edges.\n*/\nconst PHI = (1 + Math.sqrt(5)) / 2;\nconst S = 0.85; // scale\n\nconst RAW: THREE.Vector3Tuple[] = [\n  [0,  1,  PHI], [0,  1, -PHI], [0, -1,  PHI], [0, -1, -PHI],\n  [ 1,  PHI, 0], [ 1, -PHI, 0], [-1,  PHI, 0], [-1, -PHI, 0],\n  [ PHI, 0,  1], [ PHI, 0, -1], [-PHI, 0,  1], [-PHI, 0, -1],\n];\n\nconst ALL_VERTS: THREE.Vector3Tuple[] = RAW.map(\n  v => [v[0] * S, v[1] * S, v[2] * S] as THREE.Vector3Tuple,\n);\n\n/* ── 20 triangular faces (CCW from outside) ── */\nconst FACE_IDX: number[][] = [\n  [0, 2, 8],  [0, 8, 4],  [0, 4, 6],  [0, 6, 10], [0, 10, 2],\n  [3, 1, 9],  [3, 9, 5],  [3, 5, 7],  [3, 7, 11], [3, 11, 1],\n  [2, 5, 8],  [8, 9, 4],  [4, 1, 6],  [6, 11, 10],[10, 7, 2],\n  [5, 2, 7],  [9, 8, 5],  [1, 4, 9],  [11, 6, 1], [7, 10, 11],\n];\n\nconst FACES: THREE.Vector3Tuple[][] = FACE_IDX.map(\n  idx => idx.map(i => ALL_VERTS[i]),\n);\n\nconst NUM_FACES = 20;\n\nfunction computeNormal(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple, c: THREE.Vector3Tuple): THREE.Vector3 {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const vc = new THREE.Vector3(...c);\n  return vb.sub(va).cross(vc.sub(new THREE.Vector3(...a))).normalize();\n}\n\nconst NORMALS = FACES.map(f => computeNormal(f[0], f[1], f[2]));\n\nconst CENTROIDS = FACES.map(verts => new THREE.Vector3(\n  (verts[0][0] + verts[1][0] + verts[2][0]) / 3,\n  (verts[0][1] + verts[1][1] + verts[2][1]) / 3,\n  (verts[0][2] + verts[1][2] + verts[2][2]) / 3,\n));\n\n// Verify normals point outward; flip if needed\n(() => {\n  FACES.forEach((verts, fi) => {\n    if (CENTROIDS[fi].dot(NORMALS[fi]) < 0) {\n      // Swap vertices 1 and 2 to flip winding\n      const tmp = verts[1];\n      verts[1] = verts[2];\n      verts[2] = tmp;\n      const tmpIdx = FACE_IDX[fi][1];\n      FACE_IDX[fi][1] = FACE_IDX[fi][2];\n      FACE_IDX[fi][2] = tmpIdx;\n      NORMALS[fi].negate();\n    }\n  });\n})();\n\n/* ── Face values: opposite faces sum to 21 ── */\nconst FACE_VALUES = (() => {\n  const vals = new Array(NUM_FACES).fill(0);\n  const paired = new Set<number>();\n  let next = 1;\n  for (let i = 0; i < NUM_FACES; i++) {\n    if (paired.has(i)) continue;\n    let bestJ = -1, bestDot = Infinity;\n    for (let j = i + 1; j < NUM_FACES; j++) {\n      if (paired.has(j)) continue;\n      const dot = CENTROIDS[i].dot(CENTROIDS[j]);\n      if (dot < bestDot) { bestDot = dot; bestJ = j; }\n    }\n    vals[i] = next;\n    vals[bestJ] = 21 - next;\n    paired.add(i);\n    paired.add(bestJ);\n    next++;\n  }\n  return vals;\n})();\n\n/* ── 30 edges ── */\nconst EDGE_PAIRS: [THREE.Vector3Tuple, THREE.Vector3Tuple][] = (() => {\n  const set = new Set<string>();\n  const pairs: [THREE.Vector3Tuple, THREE.Vector3Tuple][] = [];\n  FACE_IDX.forEach(idx => {\n    for (let i = 0; i < 3; i++) {\n      const a = idx[i], b = idx[(i + 1) % 3];\n      const key = `${Math.min(a, b)}-${Math.max(a, b)}`;\n      if (!set.has(key)) {\n        set.add(key);\n        pairs.push([ALL_VERTS[a], ALL_VERTS[b]]);\n      }\n    }\n  });\n  return pairs;\n})();\n\n/* ── Target quaternions ── */\nconst TARGET_QUATS: Record<number, THREE.Quaternion> = {};\nFACES.forEach((verts, fi) => {\n  const normal = NORMALS[fi];\n  const c = CENTROIDS[fi];\n  const up = new THREE.Vector3(\n    verts[0][0] - c.x, verts[0][1] - c.y, verts[0][2] - c.z,\n  ).normalize();\n  const right = new THREE.Vector3().crossVectors(up, normal).normalize();\n  const m = new THREE.Matrix4().makeBasis(right, up, normal).transpose();\n  TARGET_QUATS[FACE_VALUES[fi]] = new THREE.Quaternion().setFromRotationMatrix(m);\n});\n\nconst EDGE_RADIUS = 0.025;\nconst SPIN_DURATION = 1.5;\nconst SETTLE_DURATION = 0.3;\nconst FLASH_DURATION = SETTLE_DURATION;\nconst camDir = new THREE.Vector3(0, 0, 1);\n\nconst MIN_Y = Math.min(...ALL_VERTS.map(v => v[1]));\nconst MAX_Y = Math.max(...ALL_VERTS.map(v => v[1]));\n\n/* ── Color helpers ── */\n\nfunction parseColor(color: string): [number, number, number] {\n  const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n  if (rgbMatch) return [+rgbMatch[1], +rgbMatch[2], +rgbMatch[3]];\n  const hex = color.replace('#', '');\n  const n = parseInt(hex.length === 3 ? hex.split('').map(c => c + c).join('') : hex, 16);\n  return [(n >> 16) & 255, (n >> 8) & 255, n & 255];\n}\n\nfunction luminance(color: string): number {\n  const [r, g, b] = parseColor(color).map(c => {\n    const s = c / 255;\n    return s <= 0.03928 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4);\n  });\n  return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n}\n\nfunction contrastText(bg: string): string {\n  const lum = luminance(bg);\n  if (lum > 0.85) return bg;\n  return lum > 0.4 ? '#000000' : '#ffffff';\n}\n\nfunction darken(color: string, ratio: number): string {\n  const [r, g, b] = parseColor(color);\n  const m = (c: number) => Math.round(c * (1 - ratio));\n  return `rgb(${m(r)},${m(g)},${m(b)})`;\n}\n\n/* ── Geometry / texture builders ── */\n\nfunction makeFaceGeo(verts: THREE.Vector3Tuple[], normal: THREE.Vector3): THREE.BufferGeometry {\n  const geo = new THREE.BufferGeometry();\n  const pos = new Float32Array([...verts[0], ...verts[1], ...verts[2]]);\n  const norms = new Float32Array([\n    normal.x, normal.y, normal.z,\n    normal.x, normal.y, normal.z,\n    normal.x, normal.y, normal.z,\n  ]);\n  const uvs = new Float32Array([0.5, 1.0, 0.0, 0.0, 1.0, 0.0]);\n  geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));\n  geo.setAttribute('normal', new THREE.BufferAttribute(norms, 3));\n  geo.setAttribute('uv', new THREE.BufferAttribute(uvs, 2));\n  return geo;\n}\n\nfunction makeFaceTexture(label: string, primary: string): THREE.CanvasTexture {\n  const size = 512;\n  const canvas = document.createElement('canvas');\n  canvas.width = size;\n  canvas.height = size;\n  const ctx = canvas.getContext('2d')!;\n\n  ctx.fillStyle = primary;\n  ctx.fillRect(0, 0, size, size);\n\n  const textColor = contrastText(primary);\n  ctx.fillStyle = textColor;\n  ctx.font = `bold ${label.length > 1 ? 100 : 140}px sans-serif`;\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(label, size / 2, size * 2 / 3);\n\n  const tex = new THREE.CanvasTexture(canvas);\n  tex.needsUpdate = true;\n  return tex;\n}\n\nfunction makeEdgeCylinder(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple, radius: number, baseColor: THREE.Color): THREE.CylinderGeometry {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const height = va.distanceTo(vb);\n  const geo = new THREE.CylinderGeometry(radius, radius, height, 8, 1);\n\n  const tA = (a[1] - MIN_Y) / (MAX_Y - MIN_Y);\n  const tB = (b[1] - MIN_Y) / (MAX_Y - MIN_Y);\n  const positions = geo.attributes.position;\n  const colors = new Float32Array(positions.count * 3);\n\n  for (let i = 0; i < positions.count; i++) {\n    const y = positions.getY(i);\n    const along = (y + height / 2) / height;\n    const tint = 0.5 + 0.45 * (tA + (tB - tA) * along);\n    colors[i * 3] = baseColor.r * tint;\n    colors[i * 3 + 1] = baseColor.g * tint;\n    colors[i * 3 + 2] = baseColor.b * tint;\n  }\n\n  geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n  return geo;\n}\n\nfunction edgeTransform(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple): { pos: THREE.Vector3; quat: THREE.Quaternion } {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const mid = va.clone().add(vb).multiplyScalar(0.5);\n  const dir = vb.clone().sub(va).normalize();\n  const quat = new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 1, 0), dir);\n  return { pos: mid, quat };\n}\n\n/* ── Component ── */\n\nexport default function IcosahedronDie({ rollTrigger, onResult, primary }: Props) {\n  const groupRef = useRef<THREE.Group>(null);\n  const prevTrigger = useRef(rollTrigger);\n  const hasReported = useRef(false);\n\n  const spinning = useRef(false);\n  const spinStart = useRef(0);\n  const spinAxis = useRef(new THREE.Vector3(1, 1, 0).normalize());\n  const spinSpeed = useRef(8);\n  const targetResult = useRef(0);\n  const targetQuat = useRef(new THREE.Quaternion());\n  const settleStartQuat = useRef(new THREE.Quaternion());\n  const settleStart = useRef(0);\n\n  const flashing = useRef(false);\n  const flashStart = useRef(0);\n\n  const edgeBaseColor = useMemo(() => new THREE.Color(darken(primary, 0.3)), [primary]);\n\n  const faceMeshRefs = useRef<(THREE.Mesh | null)[]>(new Array(NUM_FACES).fill(null));\n  const worldNormal = useRef(new THREE.Vector3());\n\n  const faceData = useMemo(() =>\n    FACES.map((verts, fi) => ({\n      geometry: makeFaceGeo(verts, NORMALS[fi]),\n      texture: makeFaceTexture(String(FACE_VALUES[fi]), primary),\n    })),\n    [primary],\n  );\n\n  const edges = useMemo(() =>\n    EDGE_PAIRS.map(([a, b]) => ({\n      geo: makeEdgeCylinder(a, b, EDGE_RADIUS, edgeBaseColor),\n      ...edgeTransform(a, b),\n    })),\n    [edgeBaseColor],\n  );\n\n  const sphereGeo = useMemo(() => new THREE.SphereGeometry(EDGE_RADIUS, 8, 8), []);\n\n  // Roll trigger\n  useEffect(() => {\n    if (rollTrigger === 0) return;\n    if (rollTrigger === prevTrigger.current) return;\n    prevTrigger.current = rollTrigger;\n\n    hasReported.current = false;\n    spinning.current = true;\n    spinStart.current = 0;\n\n    const sx = Math.random() < 0.5 ? -1 : 1;\n    const sy = Math.random() < 0.5 ? -1 : 1;\n    const sz = Math.random() < 0.5 ? -1 : 1;\n\n    spinAxis.current\n      .set(\n        sx * (0.5 + Math.random() * 0.5),\n        sy * (0.5 + Math.random() * 0.5),\n        sz * (0.5 + Math.random() * 0.5),\n      )\n      .normalize();\n\n    spinSpeed.current = 14 + Math.random() * 4;\n\n    targetResult.current = Math.floor(Math.random() * NUM_FACES) + 1;\n    targetQuat.current.copy(TARGET_QUATS[targetResult.current]);\n  }, [rollTrigger]);\n\n  // Tint faces based on camera-facing direction + flash\n  const tintFaces = () => {\n    if (!groupRef.current) return;\n\n    let flash = 0;\n    if (flashing.current && flashStart.current > 0) {\n      const flashElapsed = performance.now() / 1000 - flashStart.current;\n      const ft = Math.min(flashElapsed / FLASH_DURATION, 1);\n      flash = 1 - ft;\n      if (ft >= 1) flashing.current = false;\n\n      const scalePunch = 1 + 0.15 * Math.sin(ft * Math.PI);\n      groupRef.current.scale.setScalar(scalePunch);\n    }\n\n    for (let i = 0; i < NUM_FACES; i++) {\n      const mesh = faceMeshRefs.current[i];\n      if (!mesh) continue;\n      worldNormal.current.copy(NORMALS[i]).applyQuaternion(groupRef.current.quaternion);\n      const dot = worldNormal.current.dot(camDir);\n      let brightness = 0.55 + 0.45 * Math.max(0, dot);\n      if (flash > 0) {\n        brightness = brightness + (2.0 - brightness) * flash * 0.6;\n      }\n      (mesh.material as THREE.MeshBasicMaterial).color.setScalar(brightness);\n    }\n  };\n\n  useFrame((_, delta) => {\n    if (!groupRef.current) return;\n\n    tintFaces();\n\n    if (!spinning.current) return;\n\n    if (spinStart.current === 0) {\n      spinStart.current = performance.now() / 1000;\n      settleStart.current = 0;\n    }\n\n    const elapsed = performance.now() / 1000 - spinStart.current;\n\n    if (elapsed < SPIN_DURATION) {\n      const progress = elapsed / SPIN_DURATION;\n      const decay = Math.pow(1 - progress, 1.5);\n      groupRef.current.rotateOnAxis(spinAxis.current, spinSpeed.current * decay * delta);\n    } else {\n      if (settleStart.current === 0) {\n        settleStart.current = performance.now() / 1000;\n        settleStartQuat.current.copy(groupRef.current.quaternion);\n      }\n\n      const settleElapsed = performance.now() / 1000 - settleStart.current;\n      const t = Math.min(settleElapsed / SETTLE_DURATION, 1);\n      const eased = 1 - Math.pow(1 - t, 3);\n\n      groupRef.current.quaternion.copy(settleStartQuat.current).slerp(targetQuat.current, eased);\n\n      if (t >= 1) {\n        spinning.current = false;\n        groupRef.current.quaternion.copy(targetQuat.current);\n\n        if (!hasReported.current) {\n          hasReported.current = true;\n          flashing.current = true;\n          flashStart.current = performance.now() / 1000;\n          onResult(targetResult.current);\n        }\n      }\n    }\n  });\n\n  return (\n    <group ref={groupRef} position={[0, -0.15, 0]}>\n      {faceData.map((face, i) => (\n        <mesh key={i} ref={el => { faceMeshRefs.current[i] = el; }} geometry={face.geometry}>\n          <meshBasicMaterial map={face.texture} />\n        </mesh>\n      ))}\n      {edges.map((edge, i) => (\n        <mesh key={`edge-${i}`} geometry={edge.geo} position={edge.pos} quaternion={edge.quat}>\n          <meshBasicMaterial vertexColors />\n        </mesh>\n      ))}\n      {ALL_VERTS.map((v, i) => (\n        <mesh key={`corner-${i}`} geometry={sphereGeo} position={v}>\n          <meshBasicMaterial color={edgeBaseColor} />\n        </mesh>\n      ))}\n    </group>\n  );\n}\n","import { Canvas } from '@react-three/fiber';\nimport IcosahedronDie from './IcosahedronDie';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  onClick: () => void;\n  primary: string;\n  primaryDark: string;\n}\n\nexport default function D20Scene({ rollTrigger, onResult, onClick, primary, primaryDark }: Props) {\n  return (\n    <Canvas\n      flat\n      camera={{ position: [0, 0, 5.5], fov: 40 }}\n      gl={{ alpha: true, antialias: true }}\n      style={{ background: 'transparent', cursor: 'pointer' }}\n      onClick={onClick}\n    >\n      <ambientLight intensity={0.55} color=\"#ffffff\" />\n      <directionalLight position={[0, 0, 5]} intensity={0.45} color=\"#ffffff\" />\n      <directionalLight position={[3, 5, 5]} intensity={0.15} color=\"#ffffff\" />\n      <IcosahedronDie\n        rollTrigger={rollTrigger}\n        onResult={onResult}\n        primary={primary}\n        primaryDark={primaryDark}\n      />\n    </Canvas>\n  );\n}\n"],"names":["PHI","Math","sqrt","S","ALL_VERTS","map","v","FACE_IDX","FACES","idx","i","NUM_FACES","NORMALS","f","a","b","c","va","THREE","vb","vc","sub","cross","normalize","computeNormal","CENTROIDS","verts","forEach","fi","dot","tmp","tmpIdx","negate","FACE_VALUES","vals","Array","fill","paired","Set","next","has","bestJ","bestDot","Infinity","j","add","EDGE_PAIRS","set","pairs","key","concat","min","max","push","TARGET_QUATS","normal","up","x","y","z","right","crossVectors","m","makeBasis","transpose","setFromRotationMatrix","EDGE_RADIUS","SPIN_DURATION","SETTLE_DURATION","FLASH_DURATION","camDir","MIN_Y","MAX_Y","parseColor","color","rgbMatch","match","hex","replace","n","parseInt","length","split","join","contrastText","bg","lum","r","g","s","pow","luminance","makeFaceGeo","geo","pos","Float32Array","norms","uvs","setAttribute","makeFaceTexture","label","primary","size","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","textColor","font","textAlign","textBaseline","fillText","tex","needsUpdate","makeEdgeCylinder","radius","baseColor","distanceTo","tA","tB","positions","attributes","position","colors","count","tint","getY","IcosahedronDie","_ref","rollTrigger","onResult","groupRef","useRef","prevTrigger","hasReported","spinning","spinStart","spinAxis","spinSpeed","targetResult","targetQuat","settleStartQuat","settleStart","flashing","flashStart","edgeBaseColor","useMemo","ratio","round","darken","faceMeshRefs","worldNormal","faceData","geometry","texture","String","edges","_ref2","_objectSpread","mid","clone","multiplyScalar","dir","quat","setFromUnitVectors","edgeTransform","sphereGeo","useEffect","current","sx","random","sy","sz","floor","copy","useFrame","_","delta","tintFaces","flash","flashElapsed","performance","now","ft","scalePunch","sin","PI","scale","setScalar","mesh","applyQuaternion","quaternion","brightness","material","elapsed","progress","decay","rotateOnAxis","settleElapsed","t","eased","slerp","_jsxs","ref","children","face","_jsx","el","edge","vertexColors","D20Scene","onClick","primaryDark","Canvas","flat","camera","fov","gl","alpha","antialias","style","background","cursor","intensity"],"sourceRoot":""}