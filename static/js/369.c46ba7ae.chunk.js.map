{"version":3,"file":"static/js/369.c46ba7ae.chunk.js","mappings":"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","sources":["components/DiceRoller/D8/OctahedronDie.tsx","components/DiceRoller/D8/D8Scene.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react';\nimport { useFrame } from '@react-three/fiber';\nimport * as THREE from 'three';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  primary: string;\n  primaryDark: string;\n}\n\nconst S = 1.4;\n\n/* ── Vertices ── */\nconst TOP: THREE.Vector3Tuple = [0, S, 0];\nconst BOT: THREE.Vector3Tuple = [0, -S, 0];\nconst RGT: THREE.Vector3Tuple = [S, 0, 0];\nconst LFT: THREE.Vector3Tuple = [-S, 0, 0];\nconst FRT: THREE.Vector3Tuple = [0, 0, S];\nconst BCK: THREE.Vector3Tuple = [0, 0, -S];\n\nconst ALL_VERTS: THREE.Vector3Tuple[] = [TOP, BOT, RGT, LFT, FRT, BCK];\n\n/* ── 8 faces (CCW from outside) — opposite faces sum to 9 ── */\nconst FACES: THREE.Vector3Tuple[][] = [\n  [TOP, FRT, RGT],  // 0: value 1\n  [TOP, LFT, FRT],  // 1: value 2\n  [TOP, RGT, BCK],  // 2: value 3\n  [TOP, BCK, LFT],  // 3: value 4\n  [BOT, RGT, FRT],  // 4: value 5\n  [BOT, FRT, LFT],  // 5: value 6\n  [BOT, BCK, RGT],  // 6: value 7\n  [BOT, LFT, BCK],  // 7: value 8\n];\n\nconst FACE_VALUES = [1, 2, 3, 4, 5, 6, 7, 8];\n\nfunction computeNormal(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple, c: THREE.Vector3Tuple): THREE.Vector3 {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const vc = new THREE.Vector3(...c);\n  return vb.sub(va).cross(vc.sub(new THREE.Vector3(...a))).normalize();\n}\n\nconst NORMALS = FACES.map(f => computeNormal(f[0], f[1], f[2]));\n\n/* ── 12 edges ── */\nconst EDGE_PAIRS: [THREE.Vector3Tuple, THREE.Vector3Tuple][] = [\n  [TOP, RGT], [TOP, LFT], [TOP, FRT], [TOP, BCK],\n  [BOT, RGT], [BOT, LFT], [BOT, FRT], [BOT, BCK],\n  [RGT, FRT], [FRT, LFT], [LFT, BCK], [BCK, RGT],\n];\n\n/**\n * Target quaternions with full basis so numbers settle upright.\n * Build rotation from {right, up, normal} → {+X, +Y, +Z}.\n */\nconst TARGET_QUATS: Record<number, THREE.Quaternion> = {};\nFACES.forEach((verts, fi) => {\n  const normal = NORMALS[fi];\n  const cx = (verts[0][0] + verts[1][0] + verts[2][0]) / 3;\n  const cy = (verts[0][1] + verts[1][1] + verts[2][1]) / 3;\n  const cz = (verts[0][2] + verts[1][2] + verts[2][2]) / 3;\n  const up = new THREE.Vector3(\n    verts[0][0] - cx, verts[0][1] - cy, verts[0][2] - cz,\n  ).normalize();\n  const right = new THREE.Vector3().crossVectors(up, normal).normalize();\n  const m = new THREE.Matrix4().makeBasis(right, up, normal).transpose();\n  TARGET_QUATS[FACE_VALUES[fi]] = new THREE.Quaternion().setFromRotationMatrix(m);\n});\n\nconst EDGE_RADIUS = 0.035;\nconst SPIN_DURATION = 1.5;\nconst SETTLE_DURATION = 0.3;\nconst FLASH_DURATION = SETTLE_DURATION;\nconst camDir = new THREE.Vector3(0, 0, 1);\n\nconst MIN_Y = Math.min(...ALL_VERTS.map(v => v[1]));\nconst MAX_Y = Math.max(...ALL_VERTS.map(v => v[1]));\n\n/* ── Color helpers ── */\n\nfunction parseColor(color: string): [number, number, number] {\n  const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n  if (rgbMatch) return [+rgbMatch[1], +rgbMatch[2], +rgbMatch[3]];\n  const h = color.replace('#', '');\n  const n = parseInt(h.length === 3 ? h.split('').map(c => c + c).join('') : h, 16);\n  return [(n >> 16) & 255, (n >> 8) & 255, n & 255];\n}\n\nfunction luminance(color: string): number {\n  const [r, g, b] = parseColor(color).map(c => {\n    const s = c / 255;\n    return s <= 0.03928 ? s / 12.92 : Math.pow((s + 0.055) / 1.055, 2.4);\n  });\n  return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n}\n\nfunction contrastText(bg: string): string {\n  const lum = luminance(bg);\n  if (lum > 0.85) return bg;\n  return lum > 0.4 ? '#000000' : '#ffffff';\n}\n\nfunction darken(color: string, ratio: number): string {\n  const [r, g, b] = parseColor(color);\n  const m = (c: number) => Math.round(c * (1 - ratio));\n  return `rgb(${m(r)},${m(g)},${m(b)})`;\n}\n\n/* ── Geometry / texture builders ── */\n\nfunction makeFaceGeo(verts: THREE.Vector3Tuple[], normal: THREE.Vector3): THREE.BufferGeometry {\n  const geo = new THREE.BufferGeometry();\n  const pos = new Float32Array([...verts[0], ...verts[1], ...verts[2]]);\n  const norms = new Float32Array([\n    normal.x, normal.y, normal.z,\n    normal.x, normal.y, normal.z,\n    normal.x, normal.y, normal.z,\n  ]);\n  const uvs = new Float32Array([0.5, 1.0, 0.0, 0.0, 1.0, 0.0]);\n  geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));\n  geo.setAttribute('normal', new THREE.BufferAttribute(norms, 3));\n  geo.setAttribute('uv', new THREE.BufferAttribute(uvs, 2));\n  return geo;\n}\n\nfunction makeFaceTexture(num: number, primary: string): THREE.CanvasTexture {\n  const size = 512;\n  const canvas = document.createElement('canvas');\n  canvas.width = size;\n  canvas.height = size;\n  const ctx = canvas.getContext('2d')!;\n\n  ctx.fillStyle = primary;\n  ctx.fillRect(0, 0, size, size);\n\n  const textColor = contrastText(primary);\n  ctx.fillStyle = textColor;\n  ctx.font = 'bold 140px sans-serif';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(String(num), size / 2, size * 2 / 3);\n\n  const tex = new THREE.CanvasTexture(canvas);\n  tex.needsUpdate = true;\n  return tex;\n}\n\nfunction makeEdgeCylinder(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple, radius: number, baseColor: THREE.Color): THREE.CylinderGeometry {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const height = va.distanceTo(vb);\n  const geo = new THREE.CylinderGeometry(radius, radius, height, 8, 1);\n\n  const tA = (a[1] - MIN_Y) / (MAX_Y - MIN_Y);\n  const tB = (b[1] - MIN_Y) / (MAX_Y - MIN_Y);\n  const positions = geo.attributes.position;\n  const colors = new Float32Array(positions.count * 3);\n\n  for (let i = 0; i < positions.count; i++) {\n    const y = positions.getY(i);\n    const along = (y + height / 2) / height;\n    const tint = 0.5 + 0.45 * (tA + (tB - tA) * along);\n    colors[i * 3] = baseColor.r * tint;\n    colors[i * 3 + 1] = baseColor.g * tint;\n    colors[i * 3 + 2] = baseColor.b * tint;\n  }\n\n  geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n  return geo;\n}\n\nfunction edgeTransform(a: THREE.Vector3Tuple, b: THREE.Vector3Tuple): { pos: THREE.Vector3; quat: THREE.Quaternion } {\n  const va = new THREE.Vector3(...a);\n  const vb = new THREE.Vector3(...b);\n  const mid = va.clone().add(vb).multiplyScalar(0.5);\n  const dir = vb.clone().sub(va).normalize();\n  const quat = new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 1, 0), dir);\n  return { pos: mid, quat };\n}\n\n/* ── Component ── */\n\nexport default function OctahedronDie({ rollTrigger, onResult, primary, primaryDark }: Props) {\n  const groupRef = useRef<THREE.Group>(null);\n  const prevTrigger = useRef(rollTrigger);\n  const hasReported = useRef(false);\n\n  const spinning = useRef(false);\n  const spinStart = useRef(0);\n  const spinAxis = useRef(new THREE.Vector3(1, 1, 0).normalize());\n  const spinSpeed = useRef(8);\n  const targetResult = useRef(0);\n  const targetQuat = useRef(new THREE.Quaternion());\n  const settleStartQuat = useRef(new THREE.Quaternion());\n  const settleStart = useRef(0);\n\n  const flashing = useRef(false);\n  const flashStart = useRef(0);\n\n  const edgeBaseColor = useMemo(() => new THREE.Color(darken(primary, 0.02)), [primary]);\n\n  const faceMeshRefs = useRef<(THREE.Mesh | null)[]>(new Array(8).fill(null));\n  const worldNormal = useRef(new THREE.Vector3());\n\n  const faceData = useMemo(() =>\n    FACES.map((verts, fi) => ({\n      geometry: makeFaceGeo(verts, NORMALS[fi]),\n      texture: makeFaceTexture(FACE_VALUES[fi], primary),\n    })),\n    [primary],\n  );\n\n  const edges = useMemo(() =>\n    EDGE_PAIRS.map(([a, b]) => ({\n      geo: makeEdgeCylinder(a, b, EDGE_RADIUS, edgeBaseColor),\n      ...edgeTransform(a, b),\n    })),\n    [edgeBaseColor],\n  );\n\n  const sphereGeo = useMemo(() => new THREE.SphereGeometry(EDGE_RADIUS, 8, 8), []);\n\n  // Roll trigger\n  useEffect(() => {\n    if (rollTrigger === 0) return;\n    if (rollTrigger === prevTrigger.current) return;\n    prevTrigger.current = rollTrigger;\n\n    hasReported.current = false;\n    spinning.current = true;\n    spinStart.current = 0;\n\n    const sx = Math.random() < 0.5 ? -1 : 1;\n    const sy = Math.random() < 0.5 ? -1 : 1;\n    const sz = Math.random() < 0.5 ? -1 : 1;\n\n    spinAxis.current\n      .set(\n        sx * (0.5 + Math.random() * 0.5),\n        sy * (0.5 + Math.random() * 0.5),\n        sz * (0.5 + Math.random() * 0.5),\n      )\n      .normalize();\n\n    spinSpeed.current = 14 + Math.random() * 4;\n\n    targetResult.current = Math.floor(Math.random() * 8) + 1;\n    targetQuat.current.copy(TARGET_QUATS[targetResult.current]);\n  }, [rollTrigger]);\n\n  // Tint faces based on camera-facing direction + flash\n  const tintFaces = () => {\n    if (!groupRef.current) return;\n\n    let flash = 0;\n    if (flashing.current && flashStart.current > 0) {\n      const flashElapsed = performance.now() / 1000 - flashStart.current;\n      const ft = Math.min(flashElapsed / FLASH_DURATION, 1);\n      flash = 1 - ft;\n      if (ft >= 1) flashing.current = false;\n\n      const scalePunch = 1 + 0.15 * Math.sin(ft * Math.PI);\n      groupRef.current.scale.setScalar(scalePunch);\n    }\n\n    for (let i = 0; i < 8; i++) {\n      const mesh = faceMeshRefs.current[i];\n      if (!mesh) continue;\n      worldNormal.current.copy(NORMALS[i]).applyQuaternion(groupRef.current.quaternion);\n      const dot = worldNormal.current.dot(camDir);\n      let brightness = 0.55 + 0.45 * Math.max(0, dot);\n      if (flash > 0) {\n        brightness = brightness + (2.0 - brightness) * flash * 0.6;\n      }\n      (mesh.material as THREE.MeshBasicMaterial).color.setScalar(brightness);\n    }\n  };\n\n  useFrame((_, delta) => {\n    if (!groupRef.current) return;\n\n    tintFaces();\n\n    if (!spinning.current) return;\n\n    if (spinStart.current === 0) {\n      spinStart.current = performance.now() / 1000;\n      settleStart.current = 0;\n    }\n\n    const elapsed = performance.now() / 1000 - spinStart.current;\n\n    if (elapsed < SPIN_DURATION) {\n      const progress = elapsed / SPIN_DURATION;\n      const decay = Math.pow(1 - progress, 1.5);\n      groupRef.current.rotateOnAxis(spinAxis.current, spinSpeed.current * decay * delta);\n    } else {\n      if (settleStart.current === 0) {\n        settleStart.current = performance.now() / 1000;\n        settleStartQuat.current.copy(groupRef.current.quaternion);\n      }\n\n      const settleElapsed = performance.now() / 1000 - settleStart.current;\n      const t = Math.min(settleElapsed / SETTLE_DURATION, 1);\n      const eased = 1 - Math.pow(1 - t, 3);\n\n      groupRef.current.quaternion.copy(settleStartQuat.current).slerp(targetQuat.current, eased);\n\n      if (t >= 1) {\n        spinning.current = false;\n        groupRef.current.quaternion.copy(targetQuat.current);\n\n        if (!hasReported.current) {\n          hasReported.current = true;\n          flashing.current = true;\n          flashStart.current = performance.now() / 1000;\n          onResult(targetResult.current);\n        }\n      }\n    }\n  });\n\n  return (\n    <group ref={groupRef} position={[0, -0.15, 0]}>\n      {faceData.map((face, i) => (\n        <mesh key={i} ref={el => { faceMeshRefs.current[i] = el; }} geometry={face.geometry}>\n          <meshBasicMaterial map={face.texture} />\n        </mesh>\n      ))}\n      {edges.map((edge, i) => (\n        <mesh key={`edge-${i}`} geometry={edge.geo} position={edge.pos} quaternion={edge.quat}>\n          <meshBasicMaterial vertexColors />\n        </mesh>\n      ))}\n      {ALL_VERTS.map((v, i) => (\n        <mesh key={`corner-${i}`} geometry={sphereGeo} position={v}>\n          <meshBasicMaterial color={edgeBaseColor} />\n        </mesh>\n      ))}\n    </group>\n  );\n}\n","import { Canvas } from '@react-three/fiber';\nimport OctahedronDie from './OctahedronDie';\n\ninterface Props {\n  rollTrigger: number;\n  onResult: (result: number) => void;\n  onClick: () => void;\n  primary: string;\n  primaryDark: string;\n}\n\nexport default function D8Scene({ rollTrigger, onResult, onClick, primary, primaryDark }: Props) {\n  return (\n    <Canvas\n      flat\n      camera={{ position: [0, 0, 5.5], fov: 40 }}\n      gl={{ alpha: true, antialias: true }}\n      style={{ background: 'transparent', cursor: 'pointer' }}\n      onClick={onClick}\n    >\n      <ambientLight intensity={0.55} color=\"#ffffff\" />\n      <directionalLight position={[0, 0, 5]} intensity={0.45} color=\"#ffffff\" />\n      <directionalLight position={[3, 5, 5]} intensity={0.15} color=\"#ffffff\" />\n      <OctahedronDie\n        rollTrigger={rollTrigger}\n        onResult={onResult}\n        primary={primary}\n        primaryDark={primaryDark}\n      />\n    </Canvas>\n  );\n}\n"],"names":["S","TOP","BOT","RGT","LFT","FRT","BCK","ALL_VERTS","FACES","FACE_VALUES","NORMALS","map","f","a","b","c","va","THREE","vb","vc","sub","cross","normalize","computeNormal","EDGE_PAIRS","TARGET_QUATS","forEach","verts","fi","normal","cx","cy","cz","up","right","crossVectors","m","makeBasis","transpose","setFromRotationMatrix","camDir","MIN_Y","Math","min","v","MAX_Y","max","parseColor","color","rgbMatch","match","h","replace","n","parseInt","length","split","join","contrastText","bg","lum","r","g","s","pow","luminance","makeFaceGeo","geo","pos","Float32Array","norms","x","y","z","uvs","setAttribute","makeFaceTexture","num","primary","size","canvas","document","createElement","width","height","ctx","getContext","fillStyle","fillRect","textColor","font","textAlign","textBaseline","fillText","String","tex","needsUpdate","makeEdgeCylinder","radius","baseColor","distanceTo","tA","tB","positions","attributes","position","colors","count","i","tint","getY","OctahedronDie","_ref","rollTrigger","onResult","primaryDark","groupRef","useRef","prevTrigger","hasReported","spinning","spinStart","spinAxis","spinSpeed","targetResult","targetQuat","settleStartQuat","settleStart","flashing","flashStart","edgeBaseColor","useMemo","ratio","round","concat","darken","faceMeshRefs","Array","fill","worldNormal","faceData","geometry","texture","edges","_ref2","_objectSpread","mid","clone","add","multiplyScalar","dir","quat","setFromUnitVectors","edgeTransform","sphereGeo","useEffect","current","sx","random","sy","sz","set","floor","copy","useFrame","_","delta","tintFaces","flash","flashElapsed","performance","now","ft","scalePunch","sin","PI","scale","setScalar","mesh","applyQuaternion","quaternion","dot","brightness","material","elapsed","progress","decay","rotateOnAxis","settleElapsed","t","eased","slerp","_jsxs","ref","children","face","_jsx","el","edge","vertexColors","D8Scene","onClick","Canvas","flat","camera","fov","gl","alpha","antialias","style","background","cursor","intensity"],"sourceRoot":""}